const a9_0x3a9afa=a9_0xbf37;(function(_0x3004fd,_0x2faba3){const _0x5de0bb=a9_0xbf37,_0x921f0f=_0x3004fd();while(!![]){try{const _0x4c240b=-parseInt(_0x5de0bb(0x14e))/0x1*(-parseInt(_0x5de0bb(0x13d))/0x2)+parseInt(_0x5de0bb(0x11b))/0x3+parseInt(_0x5de0bb(0x135))/0x4+-parseInt(_0x5de0bb(0x12b))/0x5+parseInt(_0x5de0bb(0x127))/0x6+parseInt(_0x5de0bb(0x144))/0x7+-parseInt(_0x5de0bb(0x145))/0x8;if(_0x4c240b===_0x2faba3)break;else _0x921f0f['push'](_0x921f0f['shift']());}catch(_0x550bdb){_0x921f0f['push'](_0x921f0f['shift']());}}}(a9_0x298d,0xc76b5));function a9_0xbf37(_0x5169cb,_0x512c42){const _0x298df9=a9_0x298d();return a9_0xbf37=function(_0xbf3742,_0x24e815){_0xbf3742=_0xbf3742-0x11b;let _0x3b9cee=_0x298df9[_0xbf3742];return _0x3b9cee;},a9_0xbf37(_0x5169cb,_0x512c42);}const multer=require(a9_0x3a9afa(0x134)),fs=require('fs'),{randomUUID}=require(a9_0x3a9afa(0x133)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a9_0x3a9afa(0x123)),verifyToken=require('../libs/jwt')['verifyToken'],dir='./uploads';!fs[a9_0x3a9afa(0x136)](dir)&&fs[a9_0x3a9afa(0x13b)](dir);const express=require(a9_0x3a9afa(0x13f)),router=express['Router'](),config=require(a9_0x3a9afa(0x121)),storage=multer[a9_0x3a9afa(0x139)]({'destination':function(_0x479021,_0xe3c74,_0x481473){_0x481473(null,'uploads');}}),upload=multer({'storage':storage});function a9_0x298d(){const _0x3fb52b=['11946368RuuXou','delete','path','body','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','send','map','exports','email','302948axZNaD','files','4225671PLXaTa','length','copyFileSync','user','reduce','\x20files','../CADViewer_config.json','Error!\x20Something\x20went\x20wrong.','../libs/mysql.js','unlinkSync','json','Path\x20is\x20required','3094824LGHgyw','promise','\x20MB\x20of\x20files','status','5970760EohQaA','Please\x20upload\x20a\x20file','post','Invalid\x20user','rmdirSync','originalname','httpStatusCode','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','crypto','multer','4565956KRpVre','existsSync','folder_name','forEach','diskStorage','execute','mkdirSync','size','2lbAiqF','/files','express','readdirSync','folderLocation','log','./uploads/','948297JDWpEx'];a9_0x298d=function(){return _0x3fb52b;};return a9_0x298d();}router[a9_0x3a9afa(0x12d)](a9_0x3a9afa(0x13e),upload['array'](a9_0x3a9afa(0x14f)),verifyToken,async(_0x596982,_0x124611,_0x132c21)=>{const _0x17ba5c=a9_0x3a9afa,_0x5b360c=_0x596982[_0x17ba5c(0x14f)],{global:_0x410a03,path:_0x332974}=_0x596982[_0x17ba5c(0x148)],_0x568d72=config[_0x17ba5c(0x141)];console['log']({'global':_0x410a03}),console[_0x17ba5c(0x142)](_0x5b360c),console[_0x17ba5c(0x142)]({'user':_0x596982[_0x17ba5c(0x11e)]});if(_0x410a03){_0x5b360c[_0x17ba5c(0x138)](_0x3f8557=>{const _0x1ebe21=_0x17ba5c;fs[_0x1ebe21(0x11d)](_0x3f8557[_0x1ebe21(0x147)],(_0x332974||_0x568d72)+'/'+_0x3f8557['originalname']),fs[_0x1ebe21(0x124)](_0x3f8557[_0x1ebe21(0x147)]);}),_0x124611[_0x17ba5c(0x14a)]({'files':_0x5b360c[_0x17ba5c(0x14b)](_0x4acff8=>({..._0x4acff8,'path':(_0x332974||_0x568d72)+'/'+_0x4acff8[_0x17ba5c(0x130)]}))});return;}let _0x5411d4;try{const [_0x2809b0]=await conn[_0x17ba5c(0x128)]()[_0x17ba5c(0x13a)](_0x17ba5c(0x132),[_0x596982[_0x17ba5c(0x11e)]['email']]);_0x2809b0[_0x17ba5c(0x11c)]>0x0&&(_0x5411d4=_0x2809b0[0x0]);}catch(_0x411684){console[_0x17ba5c(0x142)]({'err':_0x411684}),_0x124611[_0x17ba5c(0x12a)](0x1f4)[_0x17ba5c(0x125)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x5411d4){_0x124611[_0x17ba5c(0x12a)](0x191)[_0x17ba5c(0x125)]({'error':_0x17ba5c(0x12e)});return;}let _0x17fd75=_0x5411d4[_0x17ba5c(0x137)];if(!_0x17fd75){_0x17fd75=randomUUID();try{await conn['promise']()[_0x17ba5c(0x13a)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x17fd75,_0x596982[_0x17ba5c(0x11e)][_0x17ba5c(0x14d)]]);}catch(_0x317fac){console['log']({'err':_0x317fac}),_0x124611[_0x17ba5c(0x12a)](0x1f4)[_0x17ba5c(0x125)]({'error':_0x17ba5c(0x122)});return;}}const _0x5cc2ec=_0x17ba5c(0x143)+_0x17fd75;!fs['existsSync'](_0x5cc2ec)&&fs[_0x17ba5c(0x13b)](_0x5cc2ec);if(!_0x5b360c){const _0xf70f6d=new Error(_0x17ba5c(0x12c));return _0xf70f6d[_0x17ba5c(0x131)]=0x190,_0x132c21(_0xf70f6d);}const _0xfeebff=fs['readdirSync'](_0x5cc2ec)['length']+_0x5b360c['length'];console[_0x17ba5c(0x142)]({'numberOfSize':_0xfeebff});if(_0xfeebff>userFolderMaximumFiles)return _0x124611[_0x17ba5c(0x12a)](0x190)[_0x17ba5c(0x125)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x17ba5c(0x120)});const _0x59fbbf=fs[_0x17ba5c(0x140)](_0x5cc2ec)[_0x17ba5c(0x11f)]((_0x42fb52,_0x1a7358)=>_0x42fb52+fs['statSync'](_0x5cc2ec+'/'+_0x1a7358)[_0x17ba5c(0x13c)],0x0),_0x10c3ee=_0x5b360c['reduce']((_0x378fbd,_0x2c608b)=>_0x378fbd+_0x2c608b[_0x17ba5c(0x13c)],0x0);console[_0x17ba5c(0x142)]({'totalSize':_0x59fbbf,'uploadedSize':_0x10c3ee});if(_0x10c3ee+_0x59fbbf>userFolderMaximumSizeInMB*0x400*0x400)return _0x124611['status'](0x190)[_0x17ba5c(0x125)]({'error':_0x17ba5c(0x149)+userFolderMaximumSizeInMB+_0x17ba5c(0x129)});_0x5b360c['forEach'](_0x78ad36=>{const _0x49a890=_0x17ba5c;fs[_0x49a890(0x11d)](_0x78ad36[_0x49a890(0x147)],_0x5cc2ec+'/'+_0x78ad36['originalname']),fs['unlinkSync'](_0x78ad36[_0x49a890(0x147)]);}),_0x124611[_0x17ba5c(0x14a)]({'files':_0x5b360c['map'](_0x2421d9=>({..._0x2421d9,'path':_0x5cc2ec+'/'+_0x2421d9[_0x17ba5c(0x130)]}))});}),router[a9_0x3a9afa(0x12d)]('/folder',verifyToken,async(_0x9bedfa,_0x4668a1)=>{const _0x49e489=a9_0x3a9afa,{path:_0x5e939d,folder_name:_0x2655e2}=_0x9bedfa[_0x49e489(0x148)];console[_0x49e489(0x142)]({'path':_0x5e939d,'folder_name':_0x2655e2});if(!_0x5e939d)return _0x4668a1[_0x49e489(0x12a)](0x190)[_0x49e489(0x125)]({'error':_0x49e489(0x126)});if(!_0x2655e2)return _0x4668a1[_0x49e489(0x12a)](0x190)[_0x49e489(0x125)]({'error':'Folder\x20name\x20is\x20required'});const _0x4e334a=_0x5e939d+'/'+_0x2655e2;!fs[_0x49e489(0x136)](_0x4e334a)&&fs[_0x49e489(0x13b)](_0x4e334a),_0x4668a1[_0x49e489(0x14a)]({'path':_0x4e334a});}),router[a9_0x3a9afa(0x146)]('/remove',verifyToken,async(_0x5c4b16,_0x4016d0)=>{const _0x59d628=a9_0x3a9afa,{isFolder:_0x4a66a8,path:_0x1588cb}=_0x5c4b16[_0x59d628(0x148)];!_0x4a66a8?fs[_0x59d628(0x124)](_0x1588cb):fs[_0x59d628(0x12f)](_0x1588cb,{'recursive':!![]}),_0x4016d0[_0x59d628(0x14a)]({'success':!![]});}),module[a9_0x3a9afa(0x14c)]=router;
const a9_0x3608e1=a9_0xf2a6;(function(_0x2c39f7,_0x3df1cd){const _0xf4d111=a9_0xf2a6,_0x55785c=_0x2c39f7();while(!![]){try{const _0x4bfdf2=-parseInt(_0xf4d111(0x98))/0x1*(-parseInt(_0xf4d111(0x9f))/0x2)+-parseInt(_0xf4d111(0xa5))/0x3+-parseInt(_0xf4d111(0xa7))/0x4+-parseInt(_0xf4d111(0xa8))/0x5*(-parseInt(_0xf4d111(0x94))/0x6)+-parseInt(_0xf4d111(0xa0))/0x7+-parseInt(_0xf4d111(0xb9))/0x8+parseInt(_0xf4d111(0xc2))/0x9;if(_0x4bfdf2===_0x3df1cd)break;else _0x55785c['push'](_0x55785c['shift']());}catch(_0x1bd4b5){_0x55785c['push'](_0x55785c['shift']());}}}(a9_0x3a40,0x4368b));const multer=require(a9_0x3608e1(0xc3)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x3608e1(0x95)),conn=require('../libs/mysql.js'),verifyToken=require(a9_0x3608e1(0xae))[a9_0x3608e1(0x91)],dir=a9_0x3608e1(0xc7);function a9_0xf2a6(_0x276be2,_0xb7fcce){const _0x3a40c1=a9_0x3a40();return a9_0xf2a6=function(_0xf2a60a,_0x2bb38b){_0xf2a60a=_0xf2a60a-0x91;let _0x31dec6=_0x3a40c1[_0xf2a60a];return _0x31dec6;},a9_0xf2a6(_0x276be2,_0xb7fcce);}!fs[a9_0x3608e1(0xad)](dir)&&fs['mkdirSync'](dir);const express=require(a9_0x3608e1(0xbb)),router=express[a9_0x3608e1(0x9e)](),config=require(a9_0x3608e1(0x95)),storage=multer[a9_0x3608e1(0xa4)]({'destination':function(_0x2da89b,_0xc9b7b0,_0x24058a){const _0x176024=a9_0x3608e1;_0x24058a(null,_0x176024(0x97));}}),upload=multer({'storage':storage});function a9_0x3a40(){const _0xbd1d0a=['UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','size','verifyToken','promise','\x20MB\x20of\x20files','12KDCdKZ','../CADViewer_config.json','folderLocation','uploads','85125wwHSGK','log','Path\x20is\x20required','folder_name','email','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','Router','6QYUScV','2539187sYIbDE','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','forEach','files','diskStorage','551895skcIQh','body','1760676RRYuuB','1217490MVMOIg','length','Invalid\x20user','send','httpStatusCode','existsSync','../libs/jwt','exports','map','user','unlinkSync','reduce','post','rmdirSync','mkdirSync','/files','/remove','2700928JUkZmy','copyFileSync','express','readdirSync','status','\x20files','path','Error!\x20Something\x20went\x20wrong.','json','7724043qGKoXM','multer','statSync','originalname','Please\x20upload\x20a\x20file','./uploads','array'];a9_0x3a40=function(){return _0xbd1d0a;};return a9_0x3a40();}router[a9_0x3608e1(0xb4)](a9_0x3608e1(0xb7),upload[a9_0x3608e1(0xc8)](a9_0x3608e1(0xa3)),verifyToken,async(_0x26e97d,_0x36f07b,_0x43f27a)=>{const _0x30820f=a9_0x3608e1,_0x14f710=_0x26e97d[_0x30820f(0xa3)],{global:_0x359d3b,path:_0x4c1aea}=_0x26e97d[_0x30820f(0xa6)],_0x3d18a9=config[_0x30820f(0x96)];console['log']({'global':_0x359d3b}),console[_0x30820f(0x99)](_0x14f710),console[_0x30820f(0x99)]({'user':_0x26e97d[_0x30820f(0xb1)]});if(_0x359d3b){_0x14f710[_0x30820f(0xa2)](_0x27844f=>{const _0x40d21c=_0x30820f;fs[_0x40d21c(0xba)](_0x27844f[_0x40d21c(0xbf)],(_0x4c1aea||_0x3d18a9)+'/'+_0x27844f[_0x40d21c(0xc5)]),fs[_0x40d21c(0xb2)](_0x27844f['path']);}),_0x36f07b[_0x30820f(0xab)]({'files':_0x14f710[_0x30820f(0xb0)](_0x16116a=>({..._0x16116a,'path':(_0x4c1aea||_0x3d18a9)+'/'+_0x16116a[_0x30820f(0xc5)]}))});return;}let _0x359b3a;try{const [_0x4d1b54]=await conn[_0x30820f(0x92)]()['execute'](_0x30820f(0xa1),[_0x26e97d[_0x30820f(0xb1)][_0x30820f(0x9c)]]);_0x4d1b54['length']>0x0&&(_0x359b3a=_0x4d1b54[0x0]);}catch(_0x5129fe){console[_0x30820f(0x99)]({'err':_0x5129fe}),_0x36f07b['status'](0x1f4)[_0x30820f(0xc1)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x359b3a){_0x36f07b['status'](0x191)[_0x30820f(0xc1)]({'error':_0x30820f(0xaa)});return;}let _0x4cf463=_0x359b3a[_0x30820f(0x9b)];if(!_0x4cf463){_0x4cf463=randomUUID();try{await conn[_0x30820f(0x92)]()['execute'](_0x30820f(0xc9),[_0x4cf463,_0x26e97d[_0x30820f(0xb1)]['email']]);}catch(_0x4122d4){console['log']({'err':_0x4122d4}),_0x36f07b['status'](0x1f4)[_0x30820f(0xc1)]({'error':_0x30820f(0xc0)});return;}}const _0x32f17f='./uploads/'+_0x4cf463;!fs[_0x30820f(0xad)](_0x32f17f)&&fs[_0x30820f(0xb6)](_0x32f17f);if(!_0x14f710){const _0x91cc63=new Error(_0x30820f(0xc6));return _0x91cc63[_0x30820f(0xac)]=0x190,_0x43f27a(_0x91cc63);}const _0x425a71=fs['readdirSync'](_0x32f17f)[_0x30820f(0xa9)]+_0x14f710[_0x30820f(0xa9)];console['log']({'numberOfSize':_0x425a71});if(_0x425a71>userFolderMaximumFiles)return _0x36f07b[_0x30820f(0xbd)](0x190)[_0x30820f(0xc1)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x30820f(0xbe)});const _0x297e5d=fs[_0x30820f(0xbc)](_0x32f17f)[_0x30820f(0xb3)]((_0x2b6e68,_0x37bf5d)=>_0x2b6e68+fs[_0x30820f(0xc4)](_0x32f17f+'/'+_0x37bf5d)[_0x30820f(0xca)],0x0),_0x3dce55=_0x14f710[_0x30820f(0xb3)]((_0x14d32c,_0x43671f)=>_0x14d32c+_0x43671f[_0x30820f(0xca)],0x0);console[_0x30820f(0x99)]({'totalSize':_0x297e5d,'uploadedSize':_0x3dce55});if(_0x3dce55+_0x297e5d>userFolderMaximumSizeInMB*0x400*0x400)return _0x36f07b[_0x30820f(0xbd)](0x190)[_0x30820f(0xc1)]({'error':_0x30820f(0x9d)+userFolderMaximumSizeInMB+_0x30820f(0x93)});_0x14f710[_0x30820f(0xa2)](_0x4bc2fc=>{const _0x355a7e=_0x30820f;fs[_0x355a7e(0xba)](_0x4bc2fc['path'],_0x32f17f+'/'+_0x4bc2fc[_0x355a7e(0xc5)]),fs['unlinkSync'](_0x4bc2fc[_0x355a7e(0xbf)]);}),_0x36f07b['send']({'files':_0x14f710[_0x30820f(0xb0)](_0x542920=>({..._0x542920,'path':_0x32f17f+'/'+_0x542920['originalname']}))});}),router['post']('/folder',verifyToken,async(_0x57ba35,_0x23c19f)=>{const _0x2ad0f0=a9_0x3608e1,{path:_0x1ea6b6,folder_name:_0x76057a}=_0x57ba35[_0x2ad0f0(0xa6)];console[_0x2ad0f0(0x99)]({'path':_0x1ea6b6,'folder_name':_0x76057a});if(!_0x1ea6b6)return _0x23c19f[_0x2ad0f0(0xbd)](0x190)['json']({'error':_0x2ad0f0(0x9a)});if(!_0x76057a)return _0x23c19f['status'](0x190)[_0x2ad0f0(0xc1)]({'error':'Folder\x20name\x20is\x20required'});const _0x24e5f8=_0x1ea6b6+'/'+_0x76057a;!fs[_0x2ad0f0(0xad)](_0x24e5f8)&&fs['mkdirSync'](_0x24e5f8),_0x23c19f[_0x2ad0f0(0xab)]({'path':_0x24e5f8});}),router['delete'](a9_0x3608e1(0xb8),verifyToken,async(_0x46a52f,_0x4f6beb)=>{const _0x171309=a9_0x3608e1,{isFolder:_0x16be02,path:_0x2c5e73}=_0x46a52f[_0x171309(0xa6)];!_0x16be02?fs[_0x171309(0xb2)](_0x2c5e73):fs[_0x171309(0xb5)](_0x2c5e73,{'recursive':!![]}),_0x4f6beb['send']({'success':!![]});}),module[a9_0x3608e1(0xaf)]=router;
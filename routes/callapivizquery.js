const a3_0x5b3df=a3_0xd226;function a3_0xd226(_0x1c4570,_0x8cbdec){const _0x30db70=a3_0x30db();return a3_0xd226=function(_0xd226bd,_0x167049){_0xd226bd=_0xd226bd-0x1c4;let _0x1de213=_0x30db70[_0xd226bd];return _0x1de213;},a3_0xd226(_0x1c4570,_0x8cbdec);}(function(_0x2cbb5c,_0x2cd174){const _0x41e097=a3_0xd226,_0x3410ca=_0x2cbb5c();while(!![]){try{const _0x36c0df=-parseInt(_0x41e097(0x1c6))/0x1+parseInt(_0x41e097(0x1db))/0x2*(parseInt(_0x41e097(0x1de))/0x3)+parseInt(_0x41e097(0x1d1))/0x4*(parseInt(_0x41e097(0x1e1))/0x5)+parseInt(_0x41e097(0x1cc))/0x6+parseInt(_0x41e097(0x1e4))/0x7*(parseInt(_0x41e097(0x1dc))/0x8)+-parseInt(_0x41e097(0x1cd))/0x9*(-parseInt(_0x41e097(0x1ce))/0xa)+parseInt(_0x41e097(0x1cf))/0xb*(-parseInt(_0x41e097(0x1d2))/0xc);if(_0x36c0df===_0x2cd174)break;else _0x3410ca['push'](_0x3410ca['shift']());}catch(_0x59cb9b){_0x3410ca['push'](_0x3410ca['shift']());}}}(a3_0x30db,0xd2fb1));function a3_0x30db(){const _0x11ce5a=['696yemclB','extraction','../CADViewer_config.json','Router','parse','Update\x20configuration\x20file\x20not\x20found','update','slice','Invalid\x20JSON\x20data','1418UPTWmA','1107616glSGQE','VizQuery_ID','4146MxPgfo','pop','split','5295XAxtgY','svg','initialization','7SdnBtC','existsSync','Failed\x20to\x20save\x20configuration\x20file','createDrawing','post','status','join','VizQuery_Space','Initialization\x20configuration\x20file\x20not\x20found','mkdirSync','exports','body','/config-file','path','Missing\x20required\x20parameters:\x20jsonConfigFilename,\x20contentLocation\x20or\x20configData','configData','Configuration\x20file\x20saved\x20successfully','Error\x20saving\x20configuration\x20file:','writeFileSync','1533989LSvLqC','string','json','stringify','json/property','replace','1682634AwmwSa','3770001RmNvyl','20gYIbdc','259963ttdKdY','dwg','5788nauiKJ'];a3_0x30db=function(){return _0x11ce5a;};return a3_0x30db();}const config=require(a3_0x5b3df(0x1d4)),cvjs_debug=config['cvjs_debug'],fs=require('fs'),path=require(a3_0x5b3df(0x1f1)),{dwgToSvg,initializeFloorplan,updateFloorplan,extractFloorplan}=require('../libs/autoexchange'),express=require('express'),router=express[a3_0x5b3df(0x1d5)](),{getHotConfig}=require('../libs/config');router['post']('',(_0x381a8c,_0x520ec5)=>{const _0x38ba6f=a3_0x5b3df,{filename:_0x260915,action:_0x443422,contentLocation:_0x5100ec,initOutputFilename:_0x2e237a,initConfigFilename:_0x4df545,updateOutputFilename:_0x24f584,updateConfigFilename:_0x29dc93,extractConfigFilename:_0x1591be,extractOutputFilename:_0x145eb4,drawingOutputFilename:_0x4a8f31}=_0x381a8c[_0x38ba6f(0x1ef)];_0x443422[_0x38ba6f(0x1e3)]&&(_0x443422[_0x38ba6f(0x1d3)]=![]);const _0x5ab838=_0x5100ec[_0x38ba6f(0x1e0)]('/'),_0x5cf67a=_0x5ab838[_0x5ab838['length']-0x1],_0x205379=_0x5cf67a[_0x38ba6f(0x1e0)]('.')[_0x38ba6f(0x1df)](),_0x48e228=_0x5ab838[_0x38ba6f(0x1d9)](0x0,-0x1)[_0x38ba6f(0x1ea)]('/');if(_0x443422['initialization']){if(!fs[_0x38ba6f(0x1e5)](path['join'](_0x48e228,_0x4df545)))return _0x520ec5[_0x38ba6f(0x1e9)](0x190)[_0x38ba6f(0x1c8)]({'error':_0x38ba6f(0x1ec)});}if(_0x443422['update']){if(!fs[_0x38ba6f(0x1e5)](path[_0x38ba6f(0x1ea)](_0x48e228,_0x29dc93)))return _0x520ec5[_0x38ba6f(0x1e9)](0x190)[_0x38ba6f(0x1c8)]({'error':_0x38ba6f(0x1d7)});}if(_0x443422[_0x38ba6f(0x1d3)]){if(!fs['existsSync'](path[_0x38ba6f(0x1ea)](_0x48e228,_0x1591be)))return _0x520ec5[_0x38ba6f(0x1e9)](0x190)[_0x38ba6f(0x1c8)]({'error':'Extraction\x20configuration\x20file\x20not\x20found'});}const _0xafd242=path[_0x38ba6f(0x1ea)](_0x48e228,''+_0x2e237a);_0x443422[_0x38ba6f(0x1e3)]&&initializeFloorplan(_0x5100ec,_0xafd242,{'cde':path[_0x38ba6f(0x1ea)](_0x48e228,_0x4df545)});const _0x49e3cf=_0x443422[_0x38ba6f(0x1e3)]?_0xafd242:_0x5100ec,_0x3cc2c0=path[_0x38ba6f(0x1ea)](_0x48e228,''+_0x24f584);_0x443422['update']&&updateFloorplan(_0x49e3cf,_0x3cc2c0,{'du2':path[_0x38ba6f(0x1ea)](_0x48e228,_0x29dc93)});const _0xede003=_0x443422[_0x38ba6f(0x1e3)]?_0xafd242:_0x443422[_0x38ba6f(0x1d8)]?_0x3cc2c0:_0x5100ec,_0x4488b2=path[_0x38ba6f(0x1ea)](_0x48e228['replace']('dwg',_0x38ba6f(0x1ca)),''+_0x145eb4);_0x443422[_0x38ba6f(0x1d3)]&&(!fs['existsSync'](_0x48e228[_0x38ba6f(0x1cb)]('dwg',_0x38ba6f(0x1ca)))&&fs[_0x38ba6f(0x1ed)](_0x48e228[_0x38ba6f(0x1cb)]('dwg',_0x38ba6f(0x1ca)),{'recursive':!![]}),extractFloorplan(_0xede003,_0x4488b2,{'dx2':path['join'](_0x48e228,_0x1591be)}));const _0x1ebb63=_0x443422['initialization']?_0xafd242:_0x443422[_0x38ba6f(0x1d8)]?_0x3cc2c0:_0x5100ec,_0x3aec74=path[_0x38ba6f(0x1ea)](_0x48e228[_0x38ba6f(0x1cb)](_0x38ba6f(0x1d0),'svg'),''+_0x4a8f31);_0x443422[_0x38ba6f(0x1e7)]&&(!fs[_0x38ba6f(0x1e5)](_0x48e228['replace'](_0x38ba6f(0x1d0),'svg'))&&fs[_0x38ba6f(0x1ed)](_0x48e228[_0x38ba6f(0x1cb)]('dwg',_0x38ba6f(0x1e2)),{'recursive':!![]}),dwgToSvg(_0x1ebb63,_0x3aec74,{'f':'svg','last':'','extents':'','rl':_0x38ba6f(0x1eb),'tl':_0x38ba6f(0x1dd)})),_0x520ec5[_0x38ba6f(0x1e9)](0xc8)[_0x38ba6f(0x1c8)]({'initial_output_path':_0x443422['initialization']?_0xafd242:_0x443422['update']?_0x3cc2c0:_0x5100ec,'update_output_path':_0x443422[_0x38ba6f(0x1d8)]?_0x3cc2c0:null,'extracted_output_path':_0x443422[_0x38ba6f(0x1d3)]?_0x4488b2:null,'drawing_output_path':_0x443422[_0x38ba6f(0x1e7)]?_0x3aec74:null});}),router[a3_0x5b3df(0x1e8)](a3_0x5b3df(0x1f0),(_0x48fe86,_0x3ef851)=>{const _0x4879ba=a3_0x5b3df,{jsonConfigFilename:_0x5eee86,contentLocation:_0x466a22}=_0x48fe86[_0x4879ba(0x1ef)],_0xf9a3b=_0x48fe86[_0x4879ba(0x1ef)][_0x4879ba(0x1f3)];if(!_0x5eee86||!_0x466a22||!_0xf9a3b)return _0x3ef851[_0x4879ba(0x1e9)](0x190)['json']({'error':_0x4879ba(0x1f2)});try{let _0xd5b6ce;try{_0xd5b6ce=typeof _0xf9a3b===_0x4879ba(0x1c7)?JSON[_0x4879ba(0x1d6)](_0xf9a3b):_0xf9a3b;}catch(_0x291539){return _0x3ef851[_0x4879ba(0x1e9)](0x190)[_0x4879ba(0x1c8)]({'error':_0x4879ba(0x1da)});}const _0x141345=_0x466a22[_0x4879ba(0x1e0)]('/'),_0x5696aa=_0x141345[_0x4879ba(0x1d9)](0x0,-0x1)[_0x4879ba(0x1ea)]('/'),_0x5bc2da=_0x5eee86,_0xa7ed30=path['join'](_0x5696aa,_0x5bc2da);fs[_0x4879ba(0x1c5)](_0xa7ed30,JSON[_0x4879ba(0x1c9)](_0xd5b6ce,null,0x2)),_0x3ef851[_0x4879ba(0x1e9)](0xc8)[_0x4879ba(0x1c8)]({'success':!![],'message':_0x4879ba(0x1f4),'filePath':_0xa7ed30});}catch(_0x366e80){console['error'](_0x4879ba(0x1c4),_0x366e80),_0x3ef851[_0x4879ba(0x1e9)](0x1f4)[_0x4879ba(0x1c8)]({'error':_0x4879ba(0x1e6),'details':_0x366e80['message']});}}),module[a3_0x5b3df(0x1ee)]=router;
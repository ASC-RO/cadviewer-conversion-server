function a1_0x333c(_0x543a40,_0x22fa16){const _0x38371d=a1_0x3837();return a1_0x333c=function(_0x333c14,_0x1e4ce3){_0x333c14=_0x333c14-0x130;let _0x557460=_0x38371d[_0x333c14];return _0x557460;},a1_0x333c(_0x543a40,_0x22fa16);}const a1_0x24cecc=a1_0x333c;(function(_0x5b9097,_0x1a02a1){const _0x367726=a1_0x333c,_0x534894=_0x5b9097();while(!![]){try{const _0x2de84c=parseInt(_0x367726(0x139))/0x1*(-parseInt(_0x367726(0x16b))/0x2)+parseInt(_0x367726(0x166))/0x3+-parseInt(_0x367726(0x148))/0x4*(-parseInt(_0x367726(0x18a))/0x5)+-parseInt(_0x367726(0x155))/0x6*(-parseInt(_0x367726(0x132))/0x7)+parseInt(_0x367726(0x136))/0x8+parseInt(_0x367726(0x16c))/0x9+-parseInt(_0x367726(0x143))/0xa*(parseInt(_0x367726(0x164))/0xb);if(_0x2de84c===_0x1a02a1)break;else _0x534894['push'](_0x534894['shift']());}catch(_0x85ae1e){_0x534894['push'](_0x534894['shift']());}}}(a1_0x3837,0x9c805));const jwt=require(a1_0x24cecc(0x152)),bcrypt=require(a1_0x24cecc(0x147)),config=require(a1_0x24cecc(0x15b)),conn=require(a1_0x24cecc(0x17f)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x24cecc(0x177))[a1_0x24cecc(0x157)],{sendWelcomeEmail}=require('../libs/email-utils'),axios=require(a1_0x24cecc(0x138));!fs[a1_0x24cecc(0x15f)](a1_0x24cecc(0x169))&&fs['mkdirSync'](a1_0x24cecc(0x169));function a1_0x3837(){const _0x57805a=['7025432sJDcKl','jwtSecretKey','axios','27446XiDQmM','Invalid\x20password','path','Error\x20during\x20user\x20creation:','sign','express','compare','success','email','Invalid\x20validation\x20token','3205130xwFayf','country_name','hash','Error!\x20Something\x20went\x20wrong.','bcrypt','128qaAphU','Invalid\x20email\x20or\x20password','Email\x20validated\x20successfully','diskStorage','User\x20already\x20exists','avatars/','languages','avatar_url','Router','reCAPTCHA\x20verification\x20error:','jsonwebtoken','promise','insertId','39120mZWxTJ','avatar','verifyToken','Error\x20during\x20reCAPTCHA\x20verification.','recaptchaEnabled','json','../CADViewer_config.json','user','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','stack','existsSync','ServerUrl','code','username','first_name','66CkVOny','crypto','564636ryXiYh','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','./avatars','log','8jgjrer','6093684TLcGis','single','status','region','callbackMethod_gatewayUrl','role','Invalid\x20user','body','data','./uploads/','is_enabled','../libs/jwt','avatars','24h','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','unlinkSync','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','crypted_password','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','../libs/mysql.js','/login','https://www.google.com/recaptcha/api/siteverify','mkdirSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','last_name','name','===================error===================','file','enableEmailVerification','time_zone','26185xtMiFa','post','city','length','819rxnWPD','execute','/validate-email/:token','.png'];a1_0x3837=function(){return _0x57805a;};return a1_0x3837();}const express=require(a1_0x24cecc(0x13e)),router=express[a1_0x24cecc(0x150)](),{randomUUID}=require(a1_0x24cecc(0x165)),storage=multer[a1_0x24cecc(0x14b)]({'destination':function(_0x49e573,_0x23faff,_0x20b895){const _0x354d90=a1_0x24cecc;_0x20b895(null,_0x354d90(0x178));}}),upload=multer({'storage':storage});router[a1_0x24cecc(0x18b)](a1_0x24cecc(0x180),async(_0x24060f,_0x487996,_0x2580a0)=>{const _0x2f4767=a1_0x24cecc;let {email:_0xa5d8e5,password:_0x3672da}=_0x24060f['body'];console[_0x2f4767(0x16a)]({'email':_0xa5d8e5,'password':_0x3672da});let _0x108f20;try{const [_0x2ba94c]=await conn[_0x2f4767(0x153)]()['execute'](_0x2f4767(0x15d),[_0xa5d8e5]);_0x2ba94c['length']>0x0&&(_0x108f20=_0x2ba94c[0x0]);}catch(_0x129c58){console[_0x2f4767(0x16a)]({'err':_0x129c58}),_0x487996['status'](0x1f4)[_0x2f4767(0x15a)]({'error':_0x2f4767(0x146)});return;}if(!_0x108f20||!await bcrypt[_0x2f4767(0x13f)](_0x3672da,_0x108f20?.[_0x2f4767(0x17d)])){_0x487996[_0x2f4767(0x16e)](0x191)[_0x2f4767(0x15a)]({'error':_0x2f4767(0x149)});return;}let _0xf8075a;try{_0xf8075a=jwt[_0x2f4767(0x13d)]({'userId':_0x108f20['id'],'email':_0x108f20[_0x2f4767(0x141)]},config[_0x2f4767(0x137)],{'expiresIn':_0x2f4767(0x179)});}catch(_0x1576c9){console[_0x2f4767(0x16a)](_0x1576c9),_0x487996['status'](0x1f4)[_0x2f4767(0x15a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x487996['status'](0xc8)[_0x2f4767(0x15a)]({'success':!![],'data':{'userId':_0x108f20['id'],'username':_0x108f20['username'],'first_name':_0x108f20['first_name'],'last_name':_0x108f20[_0x2f4767(0x184)],'email':_0x108f20[_0x2f4767(0x141)],'avatar_url':_0x108f20[_0x2f4767(0x14f)],'id':_0x108f20['id'],'role':_0x108f20[_0x2f4767(0x171)],'token':_0xf8075a}});}),router[a1_0x24cecc(0x18b)]('/signup',async(_0x27543f,_0x5d534c,_0x42e7ed)=>{const _0x227484=a1_0x24cecc,{username:_0x72a1b6,email:_0x3f49ec,password:_0x5cd162,geolocation:_0x28b00c,recaptchaToken:_0x113754}=_0x27543f['body'];if(config[_0x227484(0x159)]){if(!_0x113754)return _0x5d534c['status'](0x190)[_0x227484(0x15a)]({'error':_0x227484(0x167)});try{const _0x21658c=await axios['post'](_0x227484(0x181),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0x113754}});if(!_0x21658c['data'][_0x227484(0x140)])return _0x5d534c[_0x227484(0x16e)](0x190)[_0x227484(0x15a)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x21658c[_0x227484(0x174)]['error-codes']});}catch(_0xd10f30){return console['error'](_0x227484(0x151),_0xd10f30),_0x5d534c[_0x227484(0x16e)](0x1f4)[_0x227484(0x15a)]({'error':_0x227484(0x158)});}}const [_0x1eae37]=await conn[_0x227484(0x153)]()[_0x227484(0x133)](_0x227484(0x168),[_0x3f49ec]);if(_0x1eae37[_0x227484(0x131)]>0x0){_0x5d534c[_0x227484(0x16e)](0x1a6)[_0x227484(0x15a)]({'error':_0x227484(0x14c)});return;}const _0x11081e=await bcrypt[_0x227484(0x145)](_0x5cd162,0xa);let _0x3286bb=null,_0x4a68cc=0x1;config['enableEmailVerification']&&(_0x3286bb=randomUUID(),_0x4a68cc=0x0);let _0x53cb14=null,_0x37eade=null,_0x3723eb=null,_0x17debf=null,_0x160f6f=null,_0x13ae29=null;if(_0x28b00c)try{const _0x4407bc=_0x28b00c;_0x53cb14=_0x4407bc[_0x227484(0x130)]||null,_0x37eade=_0x4407bc[_0x227484(0x16f)]||null,_0x3723eb=_0x4407bc[_0x227484(0x144)]||null,_0x4407bc[_0x227484(0x14e)]&&_0x4407bc[_0x227484(0x14e)][_0x227484(0x131)]>0x0&&(_0x17debf=_0x4407bc['languages'][0x0][_0x227484(0x161)]||null,_0x160f6f=_0x4407bc[_0x227484(0x14e)][0x0][_0x227484(0x185)]||null),_0x4407bc[_0x227484(0x189)]&&(_0x13ae29=_0x4407bc[_0x227484(0x189)][_0x227484(0x185)]||null);}catch(_0x3f7c50){console[_0x227484(0x16a)]('Error\x20parsing\x20geolocation\x20data:',_0x3f7c50);}let _0x1218c9;try{const _0x6ceff3=randomUUID(),_0x5da60a=_0x227484(0x175)+_0x6ceff3;fs[_0x227484(0x182)](_0x5da60a);const [_0x41c29b]=await conn[_0x227484(0x153)]()[_0x227484(0x133)](_0x227484(0x17e),[_0x72a1b6,_0x3f49ec,_0x11081e,'demo_user',_0x4a68cc,_0x3286bb,_0x6ceff3,_0x53cb14,_0x37eade,_0x3723eb,_0x17debf,_0x160f6f,_0x13ae29]);if(_0x41c29b[_0x227484(0x154)]){const [_0x4dc970]=await conn[_0x227484(0x153)]()[_0x227484(0x133)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x41c29b['insertId']]);_0x4dc970['length']>0x0&&(_0x1218c9=_0x4dc970[0x0]);}}catch(_0x132c19){console[_0x227484(0x16a)](_0x227484(0x13c),_0x132c19),_0x5d534c['status'](0x1f4)[_0x227484(0x15a)]({'error':_0x227484(0x146)});return;}let _0x21dff4;try{_0x21dff4=jwt[_0x227484(0x13d)]({'userId':_0x1218c9['id'],'email':_0x1218c9['email']},config[_0x227484(0x137)],{'expiresIn':_0x227484(0x179)});}catch(_0x165eb7){_0x5d534c[_0x227484(0x16e)](0x1f4)[_0x227484(0x15a)]({'error':_0x227484(0x146)});return;}if(config[_0x227484(0x188)]){try{await sendWelcomeEmail(_0x1218c9,_0x3286bb);}catch(_0x30a0c7){console[_0x227484(0x16a)](_0x227484(0x186)),console[_0x227484(0x16a)](_0x30a0c7);}_0x5d534c[_0x227484(0x16e)](0xc8)[_0x227484(0x15a)]({'success':!![],'message':_0x227484(0x17a)});return;}_0x5d534c[_0x227484(0x16e)](0xc9)[_0x227484(0x15a)]({'success':!![],'data':{'userId':_0x1218c9['id'],'username':_0x1218c9[_0x227484(0x162)],'first_name':_0x1218c9['first_name'],'last_name':_0x1218c9[_0x227484(0x184)],'email':_0x1218c9[_0x227484(0x141)],'avatar_url':_0x1218c9[_0x227484(0x14f)],'id':_0x1218c9['id'],'role':_0x1218c9[_0x227484(0x171)],'token':_0x21dff4,'is_enabled':_0x1218c9[_0x227484(0x176)]}});}),router['post'](a1_0x24cecc(0x134),async(_0x15880c,_0xf73d90)=>{const _0x247628=a1_0x24cecc;try{const {token:_0x2256b9}=_0x15880c['params'],[_0x3aab97]=await conn['promise']()[_0x247628(0x133)](_0x247628(0x183),[_0x2256b9]);if(_0x3aab97[_0x247628(0x131)]===0x0){_0xf73d90[_0x247628(0x16e)](0x194)[_0x247628(0x15a)]({'error':_0x247628(0x142)});return;}await conn[_0x247628(0x153)]()['execute']('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?',[_0x2256b9]);const _0x5c2609=jwt[_0x247628(0x13d)]({'id':_0x3aab97[0x0]['id'],'email':_0x3aab97[0x0][_0x247628(0x141)]},config[_0x247628(0x137)],{'expiresIn':_0x247628(0x179)});_0xf73d90[_0x247628(0x16e)](0xc8)['json']({'success':!![],'message':_0x247628(0x14a),'data':{'userId':_0x3aab97[0x0]['id'],'username':_0x3aab97[0x0][_0x247628(0x162)],'first_name':_0x3aab97[0x0][_0x247628(0x163)],'last_name':_0x3aab97[0x0]['last_name'],'email':_0x3aab97[0x0][_0x247628(0x141)],'avatar_url':_0x3aab97[0x0][_0x247628(0x14f)],'id':_0x3aab97[0x0]['id'],'role':_0x3aab97[0x0][_0x247628(0x171)],'token':_0x5c2609,'is_enabled':0x1}});}catch(_0x3d038d){console[_0x247628(0x16a)](_0x247628(0x186)),console['log'](_0x3d038d),_0xf73d90[_0x247628(0x16e)](0x1f4)[_0x247628(0x15a)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x3d038d[_0x247628(0x15e)],'message':_0x3d038d['message']});}}),router[a1_0x24cecc(0x18b)]('/update-password',verifyToken,async(_0xfb52c1,_0x20a7f1,_0x7fa70b)=>{const _0xd8e494=a1_0x24cecc,{current_password:_0x56cacc,new_password:_0x110241}=_0xfb52c1[_0xd8e494(0x173)];console[_0xd8e494(0x16a)]({'body':_0xfb52c1['body']});const _0x5ad5db=_0xfb52c1[_0xd8e494(0x15c)][_0xd8e494(0x141)];let _0x3bf5b0;try{const [_0x3fb606]=await conn[_0xd8e494(0x153)]()[_0xd8e494(0x133)](_0xd8e494(0x168),[_0x5ad5db]);if(_0x3fb606[_0xd8e494(0x131)]>0x0){_0x3bf5b0=_0x3fb606[0x0];if(!await bcrypt[_0xd8e494(0x13f)](_0x56cacc,_0x3bf5b0['crypted_password'])){_0x20a7f1[_0xd8e494(0x16e)](0x191)[_0xd8e494(0x15a)]({'error':_0xd8e494(0x13a)});return;}const _0x5f3083=await bcrypt['hash'](_0x110241,0xa);await conn[_0xd8e494(0x153)]()[_0xd8e494(0x133)](_0xd8e494(0x17c),[_0x5f3083,_0x5ad5db]),_0x20a7f1[_0xd8e494(0x16e)](0xc8)[_0xd8e494(0x15a)]({'success':!![]});}}catch(_0x3c1324){console[_0xd8e494(0x16a)]({'err':_0x3c1324}),_0x20a7f1[_0xd8e494(0x16e)](0x1f4)[_0xd8e494(0x15a)]({'error':_0xd8e494(0x146)});return;}}),router[a1_0x24cecc(0x18b)]('/update-user-info',upload[a1_0x24cecc(0x16d)](a1_0x24cecc(0x156)),verifyToken,async(_0x2d45f2,_0x358370,_0x131105)=>{const _0x2f2e6f=a1_0x24cecc,{username:_0x1150e8,first_name:_0x31deda,last_name:_0x4c74e8}=_0x2d45f2[_0x2f2e6f(0x173)],_0x307f2d=_0x2d45f2[_0x2f2e6f(0x15c)][_0x2f2e6f(0x141)];let _0x1f27e9;try{const [_0x574c32]=await conn[_0x2f2e6f(0x153)]()[_0x2f2e6f(0x133)](_0x2f2e6f(0x168),[_0x307f2d]);_0x574c32[_0x2f2e6f(0x131)]>0x0&&(_0x1f27e9=_0x574c32[0x0]);}catch(_0x2e39e1){console[_0x2f2e6f(0x16a)]({'err':_0x2e39e1}),_0x358370[_0x2f2e6f(0x16e)](0x1f4)['json']({'error':_0x2f2e6f(0x146)});return;}if(!_0x1f27e9){_0x358370[_0x2f2e6f(0x16e)](0x191)[_0x2f2e6f(0x15a)]({'error':_0x2f2e6f(0x172)});return;}console['log']({'req':_0x2d45f2[_0x2f2e6f(0x173)]});let _0x2ab8d2=_0x1f27e9[_0x2f2e6f(0x14f)];if(_0x2d45f2[_0x2f2e6f(0x187)]){const _0x2afce3=_0x2f2e6f(0x14d)+randomUUID()+_0x2f2e6f(0x135);fs['copyFileSync'](_0x2d45f2[_0x2f2e6f(0x187)]['path'],'./'+_0x2afce3),fs[_0x2f2e6f(0x17b)](_0x2d45f2[_0x2f2e6f(0x187)][_0x2f2e6f(0x13b)]),config['callbackMethod_gatewayUrl_flag']?_0x2ab8d2=config[_0x2f2e6f(0x170)]+'/'+_0x2afce3:_0x2ab8d2=config[_0x2f2e6f(0x160)]+'/'+_0x2afce3;}try{await conn[_0x2f2e6f(0x153)]()['execute']('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x1150e8,_0x31deda,_0x4c74e8,_0x2ab8d2,_0x307f2d]);let _0x3006af;try{_0x3006af=jwt[_0x2f2e6f(0x13d)]({'userId':_0x1f27e9['id'],'email':_0x1f27e9['email']},config['jwtSecretKey'],{'expiresIn':_0x2f2e6f(0x179)});}catch(_0x3f6db9){console[_0x2f2e6f(0x16a)](_0x3f6db9),_0x358370[_0x2f2e6f(0x16e)](0x1f4)['json']({'error':_0x2f2e6f(0x146)});return;}_0x358370[_0x2f2e6f(0x16e)](0xc8)[_0x2f2e6f(0x15a)]({'success':!![],'data':{'userId':_0x1f27e9['id'],'username':_0x1150e8,'first_name':_0x31deda,'last_name':_0x4c74e8,'email':_0x1f27e9[_0x2f2e6f(0x141)],'avatar_url':_0x2ab8d2,'token':_0x3006af}});}catch(_0x535d1b){console['log']({'err':_0x535d1b}),_0x358370['status'](0x1f4)[_0x2f2e6f(0x15a)]({'error':_0x2f2e6f(0x146)});return;}}),module['exports']=router;
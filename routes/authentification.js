function a1_0xe4e5(){const _0x482c98=['Invalid\x20email\x20or\x20password','hash','jwtSecretKey','length','mkdirSync','copyFileSync','is_enabled','/validate-email/:token','avatars/','/login','execute','crypted_password','sign','multer','===================error===================','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','compare','/update-user-info','log','Invalid\x20validation\x20token','data','3590dEwgWV','country_name','username','name','demo_user','Error!\x20Something\x20went\x20wrong.','14267bXCqll','Router','enableEmailVerification','avatar','/update-password','path','email','first_name','Invalid\x20password','city','recaptchaSecretKey','Invalid\x20user','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','promise','status','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','./avatars','recaptchaEnabled','file','avatars','ServerUrl','130ksvtDP','https://www.google.com/recaptcha/api/siteverify','insertId','162520gdIcYe','languages','1817326hbVjoK','stack','64XkdVaa','../CADViewer_config.json','689948svyYmy','unlinkSync','error-codes','jsonwebtoken','callbackMethod_gatewayUrl_flag','reCAPTCHA\x20verification\x20error:','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','diskStorage','crypto','single','error','3657dyvnAj','time_zone','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','Error\x20during\x20user\x20creation:','json','role','Error\x20during\x20reCAPTCHA\x20verification.','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','24h','region','last_name','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','express','code','1382166BEoqlH','body','user','2494LpBioK','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','.png','avatar_url','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','../libs/email-utils','Error\x20parsing\x20geolocation\x20data:','bcrypt','axios','../libs/jwt','7611048SeZCZx','post','Email\x20validated\x20successfully'];a1_0xe4e5=function(){return _0x482c98;};return a1_0xe4e5();}const a1_0x103d8e=a1_0x46cd;function a1_0x46cd(_0x328a9b,_0x33ecce){const _0xe4e5a7=a1_0xe4e5();return a1_0x46cd=function(_0x46cd57,_0x3c3636){_0x46cd57=_0x46cd57-0x16d;let _0x5c9aba=_0xe4e5a7[_0x46cd57];return _0x5c9aba;},a1_0x46cd(_0x328a9b,_0x33ecce);}(function(_0x559d2f,_0x5e8c37){const _0x44ac5a=a1_0x46cd,_0x80ec17=_0x559d2f();while(!![]){try{const _0x299082=parseInt(_0x44ac5a(0x1cd))/0x1+-parseInt(_0x44ac5a(0x187))/0x2*(-parseInt(_0x44ac5a(0x175))/0x3)+parseInt(_0x44ac5a(0x1c7))/0x4*(-parseInt(_0x44ac5a(0x1c4))/0x5)+-parseInt(_0x44ac5a(0x191))/0x6+parseInt(_0x44ac5a(0x1c9))/0x7+-parseInt(_0x44ac5a(0x1cb))/0x8*(-parseInt(_0x44ac5a(0x184))/0x9)+-parseInt(_0x44ac5a(0x1a9))/0xa*(parseInt(_0x44ac5a(0x1af))/0xb);if(_0x299082===_0x5e8c37)break;else _0x80ec17['push'](_0x80ec17['shift']());}catch(_0x2e0ab1){_0x80ec17['push'](_0x80ec17['shift']());}}}(a1_0xe4e5,0xdd9dc));const jwt=require(a1_0x103d8e(0x16d)),bcrypt=require(a1_0x103d8e(0x18e)),config=require(a1_0x103d8e(0x1cc)),conn=require('../libs/mysql.js'),multer=require(a1_0x103d8e(0x1a1)),fs=require('fs'),verifyToken=require(a1_0x103d8e(0x190))['verifyToken'],{sendWelcomeEmail}=require(a1_0x103d8e(0x18c)),axios=require(a1_0x103d8e(0x18f));!fs['existsSync'](a1_0x103d8e(0x1bf))&&fs[a1_0x103d8e(0x198)]('./avatars');const express=require(a1_0x103d8e(0x182)),router=express[a1_0x103d8e(0x1b0)](),{randomUUID}=require(a1_0x103d8e(0x172)),storage=multer[a1_0x103d8e(0x171)]({'destination':function(_0x45bf9b,_0x5254ad,_0x294781){const _0x4f1077=a1_0x103d8e;_0x294781(null,_0x4f1077(0x1c2));}}),upload=multer({'storage':storage});router[a1_0x103d8e(0x192)](a1_0x103d8e(0x19d),async(_0x4caf82,_0x21b4fc,_0x3d8f7b)=>{const _0x5615e8=a1_0x103d8e;let {email:_0x8b4958,password:_0x4444c0}=_0x4caf82['body'];console[_0x5615e8(0x1a6)]({'email':_0x8b4958,'password':_0x4444c0});let _0x4430d4;try{const [_0x2cd65d]=await conn[_0x5615e8(0x1bc)]()[_0x5615e8(0x19e)](_0x5615e8(0x1be),[_0x8b4958]);_0x2cd65d[_0x5615e8(0x197)]>0x0&&(_0x4430d4=_0x2cd65d[0x0]);}catch(_0x5b6a9d){console[_0x5615e8(0x1a6)]({'err':_0x5b6a9d}),_0x21b4fc['status'](0x1f4)[_0x5615e8(0x179)]({'error':_0x5615e8(0x1ae)});return;}if(!_0x4430d4||!await bcrypt['compare'](_0x4444c0,_0x4430d4?.[_0x5615e8(0x19f)])){_0x21b4fc[_0x5615e8(0x1bd)](0x191)[_0x5615e8(0x179)]({'error':_0x5615e8(0x194)});return;}let _0x145ffb;try{_0x145ffb=jwt[_0x5615e8(0x1a0)]({'userId':_0x4430d4['id'],'email':_0x4430d4['email']},config[_0x5615e8(0x196)],{'expiresIn':'24h'});}catch(_0x9165ed){console[_0x5615e8(0x1a6)](_0x9165ed),_0x21b4fc['status'](0x1f4)['json']({'error':_0x5615e8(0x1ae)});return;}_0x21b4fc[_0x5615e8(0x1bd)](0xc8)['json']({'success':!![],'data':{'userId':_0x4430d4['id'],'username':_0x4430d4[_0x5615e8(0x1ab)],'first_name':_0x4430d4[_0x5615e8(0x1b6)],'last_name':_0x4430d4[_0x5615e8(0x180)],'email':_0x4430d4[_0x5615e8(0x1b5)],'avatar_url':_0x4430d4[_0x5615e8(0x18a)],'id':_0x4430d4['id'],'role':_0x4430d4[_0x5615e8(0x17a)],'token':_0x145ffb}});}),router[a1_0x103d8e(0x192)]('/signup',async(_0x32d314,_0xe76734,_0x20a556)=>{const _0x3234e0=a1_0x103d8e,{username:_0x352257,email:_0x4c64ab,password:_0x1eae0b,geolocation:_0x133297,recaptchaToken:_0x15b546}=_0x32d314[_0x3234e0(0x185)];if(config[_0x3234e0(0x1c0)]){if(!_0x15b546)return _0xe76734[_0x3234e0(0x1bd)](0x190)[_0x3234e0(0x179)]({'error':_0x3234e0(0x181)});try{const _0x4692a0=await axios[_0x3234e0(0x192)](_0x3234e0(0x1c5),null,{'params':{'secret':config[_0x3234e0(0x1b9)],'response':_0x15b546}});if(!_0x4692a0[_0x3234e0(0x1a8)]['success'])return _0xe76734[_0x3234e0(0x1bd)](0x190)[_0x3234e0(0x179)]({'error':_0x3234e0(0x181),'recaptchaErrors':_0x4692a0[_0x3234e0(0x1a8)][_0x3234e0(0x1cf)]});}catch(_0x1254f7){return console[_0x3234e0(0x174)](_0x3234e0(0x16f),_0x1254f7),_0xe76734[_0x3234e0(0x1bd)](0x1f4)[_0x3234e0(0x179)]({'error':_0x3234e0(0x17b)});}}const [_0x14fd55]=await conn[_0x3234e0(0x1bc)]()[_0x3234e0(0x19e)](_0x3234e0(0x170),[_0x4c64ab]);if(_0x14fd55[_0x3234e0(0x197)]>0x0){_0xe76734[_0x3234e0(0x1bd)](0x1a6)[_0x3234e0(0x179)]({'error':'User\x20already\x20exists'});return;}const _0x1a869e=await bcrypt['hash'](_0x1eae0b,0xa);let _0x3b8b3e=null,_0x3c4d3d=0x1;config[_0x3234e0(0x1b1)]&&(_0x3b8b3e=randomUUID(),_0x3c4d3d=0x0);let _0x3c69ad=null,_0x15695d=null,_0x3a743a=null,_0x564a11=null,_0x2f60c2=null,_0x2c21a6=null;if(_0x133297)try{const _0x4b35ae=_0x133297;_0x3c69ad=_0x4b35ae[_0x3234e0(0x1b8)]||null,_0x15695d=_0x4b35ae[_0x3234e0(0x17f)]||null,_0x3a743a=_0x4b35ae[_0x3234e0(0x1aa)]||null,_0x4b35ae[_0x3234e0(0x1c8)]&&_0x4b35ae['languages']['length']>0x0&&(_0x564a11=_0x4b35ae[_0x3234e0(0x1c8)][0x0][_0x3234e0(0x183)]||null,_0x2f60c2=_0x4b35ae[_0x3234e0(0x1c8)][0x0]['name']||null),_0x4b35ae[_0x3234e0(0x176)]&&(_0x2c21a6=_0x4b35ae[_0x3234e0(0x176)][_0x3234e0(0x1ac)]||null);}catch(_0x4a6708){console[_0x3234e0(0x1a6)](_0x3234e0(0x18d),_0x4a6708);}let _0x39685d;try{const _0x2c4ce6=randomUUID(),_0x49ab98='./uploads/'+_0x2c4ce6;fs[_0x3234e0(0x198)](_0x49ab98);const [_0x1a26c0]=await conn[_0x3234e0(0x1bc)]()[_0x3234e0(0x19e)](_0x3234e0(0x1bb),[_0x352257,_0x4c64ab,_0x1a869e,_0x3234e0(0x1ad),_0x3c4d3d,_0x3b8b3e,_0x2c4ce6,_0x3c69ad,_0x15695d,_0x3a743a,_0x564a11,_0x2f60c2,_0x2c21a6]);if(_0x1a26c0[_0x3234e0(0x1c6)]){const [_0x5bb4e2]=await conn[_0x3234e0(0x1bc)]()['execute'](_0x3234e0(0x177),[_0x1a26c0[_0x3234e0(0x1c6)]]);_0x5bb4e2[_0x3234e0(0x197)]>0x0&&(_0x39685d=_0x5bb4e2[0x0]);}}catch(_0x5f058c){console[_0x3234e0(0x1a6)](_0x3234e0(0x178),_0x5f058c),_0xe76734[_0x3234e0(0x1bd)](0x1f4)['json']({'error':_0x3234e0(0x1ae)});return;}let _0x54d3d3;try{_0x54d3d3=jwt[_0x3234e0(0x1a0)]({'userId':_0x39685d['id'],'email':_0x39685d['email']},config['jwtSecretKey'],{'expiresIn':_0x3234e0(0x17e)});}catch(_0x421fee){_0xe76734[_0x3234e0(0x1bd)](0x1f4)[_0x3234e0(0x179)]({'error':_0x3234e0(0x1ae)});return;}if(config[_0x3234e0(0x1b1)]){try{await sendWelcomeEmail(_0x39685d,_0x3b8b3e);}catch(_0x47eb97){console[_0x3234e0(0x1a6)](_0x3234e0(0x1a2)),console[_0x3234e0(0x1a6)](_0x47eb97);}_0xe76734[_0x3234e0(0x1bd)](0xc8)['json']({'success':!![],'message':_0x3234e0(0x188)});return;}_0xe76734['status'](0xc9)['json']({'success':!![],'data':{'userId':_0x39685d['id'],'username':_0x39685d['username'],'first_name':_0x39685d[_0x3234e0(0x1b6)],'last_name':_0x39685d[_0x3234e0(0x180)],'email':_0x39685d['email'],'avatar_url':_0x39685d[_0x3234e0(0x18a)],'id':_0x39685d['id'],'role':_0x39685d[_0x3234e0(0x17a)],'token':_0x54d3d3,'is_enabled':_0x39685d[_0x3234e0(0x19a)]}});}),router[a1_0x103d8e(0x192)](a1_0x103d8e(0x19b),async(_0x542cc3,_0x4ba14f)=>{const _0xfc2dff=a1_0x103d8e;try{const {token:_0x19d048}=_0x542cc3['params'],[_0x170dc8]=await conn[_0xfc2dff(0x1bc)]()[_0xfc2dff(0x19e)](_0xfc2dff(0x1a3),[_0x19d048]);if(_0x170dc8[_0xfc2dff(0x197)]===0x0){_0x4ba14f[_0xfc2dff(0x1bd)](0x194)[_0xfc2dff(0x179)]({'error':_0xfc2dff(0x1a7)});return;}await conn[_0xfc2dff(0x1bc)]()[_0xfc2dff(0x19e)](_0xfc2dff(0x18b),[_0x19d048]);const _0x30f095=jwt[_0xfc2dff(0x1a0)]({'id':_0x170dc8[0x0]['id'],'email':_0x170dc8[0x0]['email']},config[_0xfc2dff(0x196)],{'expiresIn':_0xfc2dff(0x17e)});_0x4ba14f[_0xfc2dff(0x1bd)](0xc8)[_0xfc2dff(0x179)]({'success':!![],'message':_0xfc2dff(0x193),'data':{'userId':_0x170dc8[0x0]['id'],'username':_0x170dc8[0x0]['username'],'first_name':_0x170dc8[0x0]['first_name'],'last_name':_0x170dc8[0x0][_0xfc2dff(0x180)],'email':_0x170dc8[0x0][_0xfc2dff(0x1b5)],'avatar_url':_0x170dc8[0x0]['avatar_url'],'id':_0x170dc8[0x0]['id'],'role':_0x170dc8[0x0]['role'],'token':_0x30f095,'is_enabled':0x1}});}catch(_0x2788fd){console['log'](_0xfc2dff(0x1a2)),console[_0xfc2dff(0x1a6)](_0x2788fd),_0x4ba14f[_0xfc2dff(0x1bd)](0x1f4)[_0xfc2dff(0x179)]({'error':_0xfc2dff(0x1ae),'stack':_0x2788fd[_0xfc2dff(0x1ca)],'message':_0x2788fd['message']});}}),router[a1_0x103d8e(0x192)](a1_0x103d8e(0x1b3),verifyToken,async(_0x4d47b4,_0x2b27e4,_0x32a6fc)=>{const _0x513165=a1_0x103d8e,{current_password:_0x583fdd,new_password:_0x45ad30}=_0x4d47b4[_0x513165(0x185)];console[_0x513165(0x1a6)]({'body':_0x4d47b4[_0x513165(0x185)]});const _0x3a0a58=_0x4d47b4[_0x513165(0x186)][_0x513165(0x1b5)];let _0x40f8e6;try{const [_0x2fd93e]=await conn[_0x513165(0x1bc)]()[_0x513165(0x19e)](_0x513165(0x170),[_0x3a0a58]);if(_0x2fd93e[_0x513165(0x197)]>0x0){_0x40f8e6=_0x2fd93e[0x0];if(!await bcrypt[_0x513165(0x1a4)](_0x583fdd,_0x40f8e6['crypted_password'])){_0x2b27e4[_0x513165(0x1bd)](0x191)[_0x513165(0x179)]({'error':_0x513165(0x1b7)});return;}const _0x9576fc=await bcrypt[_0x513165(0x195)](_0x45ad30,0xa);await conn[_0x513165(0x1bc)]()[_0x513165(0x19e)](_0x513165(0x17c),[_0x9576fc,_0x3a0a58]),_0x2b27e4['status'](0xc8)[_0x513165(0x179)]({'success':!![]});}}catch(_0x36623b){console['log']({'err':_0x36623b}),_0x2b27e4[_0x513165(0x1bd)](0x1f4)['json']({'error':_0x513165(0x1ae)});return;}}),router[a1_0x103d8e(0x192)](a1_0x103d8e(0x1a5),upload[a1_0x103d8e(0x173)](a1_0x103d8e(0x1b2)),verifyToken,async(_0xc32c6a,_0x1b7fdc,_0x103a1c)=>{const _0x2b3973=a1_0x103d8e,{username:_0x45c9b7,first_name:_0x4222af,last_name:_0x1bd868}=_0xc32c6a[_0x2b3973(0x185)],_0x58cf57=_0xc32c6a['user'][_0x2b3973(0x1b5)];let _0x32168f;try{const [_0x1eb1aa]=await conn[_0x2b3973(0x1bc)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x58cf57]);_0x1eb1aa['length']>0x0&&(_0x32168f=_0x1eb1aa[0x0]);}catch(_0x544fda){console[_0x2b3973(0x1a6)]({'err':_0x544fda}),_0x1b7fdc['status'](0x1f4)[_0x2b3973(0x179)]({'error':_0x2b3973(0x1ae)});return;}if(!_0x32168f){_0x1b7fdc[_0x2b3973(0x1bd)](0x191)[_0x2b3973(0x179)]({'error':_0x2b3973(0x1ba)});return;}console[_0x2b3973(0x1a6)]({'req':_0xc32c6a[_0x2b3973(0x185)]});let _0x8085c6=_0x32168f['avatar_url'];if(_0xc32c6a['file']){const _0x3baa0b=_0x2b3973(0x19c)+randomUUID()+_0x2b3973(0x189);fs[_0x2b3973(0x199)](_0xc32c6a[_0x2b3973(0x1c1)][_0x2b3973(0x1b4)],'./'+_0x3baa0b),fs[_0x2b3973(0x1ce)](_0xc32c6a[_0x2b3973(0x1c1)]['path']),config[_0x2b3973(0x16e)]?_0x8085c6=config['callbackMethod_gatewayUrl']+'/'+_0x3baa0b:_0x8085c6=config[_0x2b3973(0x1c3)]+'/'+_0x3baa0b;}try{await conn[_0x2b3973(0x1bc)]()[_0x2b3973(0x19e)](_0x2b3973(0x17d),[_0x45c9b7,_0x4222af,_0x1bd868,_0x8085c6,_0x58cf57]);let _0xb588a9;try{_0xb588a9=jwt['sign']({'userId':_0x32168f['id'],'email':_0x32168f[_0x2b3973(0x1b5)]},config[_0x2b3973(0x196)],{'expiresIn':_0x2b3973(0x17e)});}catch(_0x6cc7ee){console[_0x2b3973(0x1a6)](_0x6cc7ee),_0x1b7fdc[_0x2b3973(0x1bd)](0x1f4)['json']({'error':_0x2b3973(0x1ae)});return;}_0x1b7fdc[_0x2b3973(0x1bd)](0xc8)[_0x2b3973(0x179)]({'success':!![],'data':{'userId':_0x32168f['id'],'username':_0x45c9b7,'first_name':_0x4222af,'last_name':_0x1bd868,'email':_0x32168f[_0x2b3973(0x1b5)],'avatar_url':_0x8085c6,'token':_0xb588a9}});}catch(_0x156033){console['log']({'err':_0x156033}),_0x1b7fdc[_0x2b3973(0x1bd)](0x1f4)[_0x2b3973(0x179)]({'error':_0x2b3973(0x1ae)});return;}}),module['exports']=router;
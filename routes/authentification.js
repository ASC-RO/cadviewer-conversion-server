function a1_0x729b(_0x25d7d9,_0x47f0ac){const _0x587f0b=a1_0x587f();return a1_0x729b=function(_0x729b73,_0x2f4cf5){_0x729b73=_0x729b73-0xdd;let _0x60750=_0x587f0b[_0x729b73];return _0x60750;},a1_0x729b(_0x25d7d9,_0x47f0ac);}const a1_0x3c014b=a1_0x729b;(function(_0x29e6e5,_0x288fc4){const _0x8c2da3=a1_0x729b,_0x3c06ab=_0x29e6e5();while(!![]){try{const _0x4c7323=-parseInt(_0x8c2da3(0xfb))/0x1+-parseInt(_0x8c2da3(0xdf))/0x2*(-parseInt(_0x8c2da3(0xfd))/0x3)+parseInt(_0x8c2da3(0x133))/0x4*(-parseInt(_0x8c2da3(0x12c))/0x5)+-parseInt(_0x8c2da3(0x12e))/0x6*(parseInt(_0x8c2da3(0x12f))/0x7)+-parseInt(_0x8c2da3(0xed))/0x8*(parseInt(_0x8c2da3(0x137))/0x9)+-parseInt(_0x8c2da3(0xe5))/0xa*(-parseInt(_0x8c2da3(0x12a))/0xb)+parseInt(_0x8c2da3(0xf7))/0xc;if(_0x4c7323===_0x288fc4)break;else _0x3c06ab['push'](_0x3c06ab['shift']());}catch(_0x5d3329){_0x3c06ab['push'](_0x3c06ab['shift']());}}}(a1_0x587f,0xf203e));function a1_0x587f(){const _0x1a90a5=['axios','exports','diskStorage','username','https://www.google.com/recaptcha/api/siteverify','data','../CADViewer_config.json','Email\x20validated\x20successfully','promise','9144124ltJwfm','error','1470dLUpeb','sign','1074jFAHst','60018gvLgCR','recaptchaSecretKey','reCAPTCHA\x20verification\x20error:','city','16232ZDcWqx','enableEmailVerification','time_zone','===================error===================','9366399LRqVoF','recaptchaEnabled','name','../libs/email-utils','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','17774YBatoC','/update-user-info','../libs/jwt','message','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','/login','10FPLhjR','code','stack','is_enabled','body','Invalid\x20password','jwtSecretKey','Router','8mooxTU','file','/validate-email/:token','User\x20already\x20exists','mkdirSync','avatars','Error\x20parsing\x20geolocation\x20data:','log','first_name','../libs/mysql.js','48193932mQHdNN','path','params','jsonwebtoken','158738synaks','success','24CVmPEy','unlinkSync','bcrypt','status','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','user','24h','./avatars','/update-password','avatar_url','Error!\x20Something\x20went\x20wrong.','execute','insertId','hash','Invalid\x20user','express','length','json','crypted_password','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','role','verifyToken','email','multer','demo_user','.png','last_name','avatar','languages','Invalid\x20validation\x20token','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','/signup','post','compare'];a1_0x587f=function(){return _0x1a90a5;};return a1_0x587f();}const jwt=require(a1_0x3c014b(0xfa)),bcrypt=require(a1_0x3c014b(0xff)),config=require(a1_0x3c014b(0x127)),conn=require(a1_0x3c014b(0xf6)),multer=require(a1_0x3c014b(0x115)),fs=require('fs'),verifyToken=require(a1_0x3c014b(0xe1))[a1_0x3c014b(0x113)],{sendWelcomeEmail}=require(a1_0x3c014b(0xdd)),axios=require(a1_0x3c014b(0x121));!fs['existsSync']('./avatars')&&fs[a1_0x3c014b(0xf1)](a1_0x3c014b(0x105));const express=require(a1_0x3c014b(0x10d)),router=express[a1_0x3c014b(0xec)](),{randomUUID}=require('crypto'),storage=multer[a1_0x3c014b(0x123)]({'destination':function(_0xfb8791,_0x4a718c,_0x347c1a){const _0x210a03=a1_0x3c014b;_0x347c1a(null,_0x210a03(0xf2));}}),upload=multer({'storage':storage});router[a1_0x3c014b(0x11f)](a1_0x3c014b(0xe4),async(_0x37b269,_0x2ae7f3,_0x3a0f9c)=>{const _0x391e9e=a1_0x3c014b;let {email:_0x1fb56d,password:_0x32fdcb}=_0x37b269[_0x391e9e(0xe9)];console['log']({'email':_0x1fb56d,'password':_0x32fdcb});let _0x4828f9;try{const [_0x3d6600]=await conn[_0x391e9e(0x129)]()['execute'](_0x391e9e(0x11d),[_0x1fb56d]);_0x3d6600['length']>0x0&&(_0x4828f9=_0x3d6600[0x0]);}catch(_0x28493c){console[_0x391e9e(0xf4)]({'err':_0x28493c}),_0x2ae7f3[_0x391e9e(0x100)](0x1f4)[_0x391e9e(0x10f)]({'error':_0x391e9e(0x108)});return;}if(!_0x4828f9||!await bcrypt[_0x391e9e(0x120)](_0x32fdcb,_0x4828f9?.[_0x391e9e(0x110)])){_0x2ae7f3[_0x391e9e(0x100)](0x191)[_0x391e9e(0x10f)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x4ae24b;try{_0x4ae24b=jwt[_0x391e9e(0x12d)]({'userId':_0x4828f9['id'],'email':_0x4828f9[_0x391e9e(0x114)]},config[_0x391e9e(0xeb)],{'expiresIn':_0x391e9e(0x104)});}catch(_0x1431fe){console[_0x391e9e(0xf4)](_0x1431fe),_0x2ae7f3[_0x391e9e(0x100)](0x1f4)[_0x391e9e(0x10f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x2ae7f3['status'](0xc8)[_0x391e9e(0x10f)]({'success':!![],'data':{'userId':_0x4828f9['id'],'username':_0x4828f9['username'],'first_name':_0x4828f9['first_name'],'last_name':_0x4828f9[_0x391e9e(0x118)],'email':_0x4828f9['email'],'avatar_url':_0x4828f9[_0x391e9e(0x107)],'id':_0x4828f9['id'],'role':_0x4828f9['role'],'token':_0x4ae24b}});}),router['post'](a1_0x3c014b(0x11e),async(_0x1f932e,_0x1975a0,_0x1cc117)=>{const _0x1e872d=a1_0x3c014b,{username:_0x1f9ed5,email:_0x15e5eb,password:_0x5b8ace,geolocation:_0x3c4d7b,recaptchaToken:_0x140275}=_0x1f932e[_0x1e872d(0xe9)];if(config[_0x1e872d(0x138)]){if(!_0x140275)return _0x1975a0[_0x1e872d(0x100)](0x190)[_0x1e872d(0x10f)]({'error':_0x1e872d(0x111)});try{const _0x452bec=await axios[_0x1e872d(0x11f)](_0x1e872d(0x125),null,{'params':{'secret':config[_0x1e872d(0x130)],'response':_0x140275}});if(!_0x452bec['data'][_0x1e872d(0xfc)])return _0x1975a0[_0x1e872d(0x100)](0x190)[_0x1e872d(0x10f)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x452bec[_0x1e872d(0x126)]['error-codes']});}catch(_0x45123c){return console[_0x1e872d(0x12b)](_0x1e872d(0x131),_0x45123c),_0x1975a0['status'](0x1f4)[_0x1e872d(0x10f)]({'error':'Error\x20during\x20reCAPTCHA\x20verification.'});}}const [_0x108f56]=await conn[_0x1e872d(0x129)]()[_0x1e872d(0x109)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x15e5eb]);if(_0x108f56[_0x1e872d(0x10e)]>0x0){_0x1975a0[_0x1e872d(0x100)](0x1a6)[_0x1e872d(0x10f)]({'error':_0x1e872d(0xf0)});return;}const _0x1a7732=await bcrypt[_0x1e872d(0x10b)](_0x5b8ace,0xa);let _0x20179c=null,_0x1d557e=0x1;config[_0x1e872d(0x134)]&&(_0x20179c=randomUUID(),_0x1d557e=0x0);let _0x99b6ca=null,_0xa30175=null,_0x540e2f=null,_0x10ca4a=null,_0x2f00c8=null,_0x470f1f=null;if(_0x3c4d7b)try{const _0x53fc25=_0x3c4d7b;_0x99b6ca=_0x53fc25[_0x1e872d(0x132)]||null,_0xa30175=_0x53fc25['region']||null,_0x540e2f=_0x53fc25['country_name']||null,_0x53fc25[_0x1e872d(0x11a)]&&_0x53fc25[_0x1e872d(0x11a)][_0x1e872d(0x10e)]>0x0&&(_0x10ca4a=_0x53fc25[_0x1e872d(0x11a)][0x0][_0x1e872d(0xe6)]||null,_0x2f00c8=_0x53fc25[_0x1e872d(0x11a)][0x0][_0x1e872d(0x139)]||null),_0x53fc25[_0x1e872d(0x135)]&&(_0x470f1f=_0x53fc25['time_zone'][_0x1e872d(0x139)]||null);}catch(_0x39fb54){console[_0x1e872d(0xf4)](_0x1e872d(0xf3),_0x39fb54);}let _0x150726;try{const _0xe2e975=randomUUID(),_0xf506ea='./uploads/'+_0xe2e975;fs[_0x1e872d(0xf1)](_0xf506ea);const [_0x16b396]=await conn[_0x1e872d(0x129)]()[_0x1e872d(0x109)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x1f9ed5,_0x15e5eb,_0x1a7732,_0x1e872d(0x116),_0x1d557e,_0x20179c,_0xe2e975,_0x99b6ca,_0xa30175,_0x540e2f,_0x10ca4a,_0x2f00c8,_0x470f1f]);if(_0x16b396[_0x1e872d(0x10a)]){const [_0x2aa73c]=await conn[_0x1e872d(0x129)]()[_0x1e872d(0x109)](_0x1e872d(0x11c),[_0x16b396['insertId']]);_0x2aa73c[_0x1e872d(0x10e)]>0x0&&(_0x150726=_0x2aa73c[0x0]);}}catch(_0x3ab403){console[_0x1e872d(0xf4)]('Error\x20during\x20user\x20creation:',_0x3ab403),_0x1975a0[_0x1e872d(0x100)](0x1f4)[_0x1e872d(0x10f)]({'error':_0x1e872d(0x108)});return;}let _0x4b91c4;try{_0x4b91c4=jwt['sign']({'userId':_0x150726['id'],'email':_0x150726[_0x1e872d(0x114)]},config[_0x1e872d(0xeb)],{'expiresIn':'24h'});}catch(_0x32ca48){_0x1975a0['status'](0x1f4)[_0x1e872d(0x10f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(config['enableEmailVerification']){try{await sendWelcomeEmail(_0x150726,_0x20179c);}catch(_0x5f0a7e){console[_0x1e872d(0xf4)](_0x1e872d(0x136)),console[_0x1e872d(0xf4)](_0x5f0a7e);}_0x1975a0[_0x1e872d(0x100)](0xc8)[_0x1e872d(0x10f)]({'success':!![],'message':'Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.'});return;}_0x1975a0[_0x1e872d(0x100)](0xc9)[_0x1e872d(0x10f)]({'success':!![],'data':{'userId':_0x150726['id'],'username':_0x150726[_0x1e872d(0x124)],'first_name':_0x150726[_0x1e872d(0xf5)],'last_name':_0x150726['last_name'],'email':_0x150726['email'],'avatar_url':_0x150726['avatar_url'],'id':_0x150726['id'],'role':_0x150726[_0x1e872d(0x112)],'token':_0x4b91c4,'is_enabled':_0x150726[_0x1e872d(0xe8)]}});}),router[a1_0x3c014b(0x11f)](a1_0x3c014b(0xef),async(_0x263da2,_0x3e414e)=>{const _0x4925bf=a1_0x3c014b;try{const {token:_0x48ff01}=_0x263da2[_0x4925bf(0xf9)],[_0x41858a]=await conn[_0x4925bf(0x129)]()[_0x4925bf(0x109)](_0x4925bf(0xe3),[_0x48ff01]);if(_0x41858a[_0x4925bf(0x10e)]===0x0){_0x3e414e['status'](0x194)[_0x4925bf(0x10f)]({'error':_0x4925bf(0x11b)});return;}await conn[_0x4925bf(0x129)]()[_0x4925bf(0x109)](_0x4925bf(0x101),[_0x48ff01]);const _0x18c0d9=jwt[_0x4925bf(0x12d)]({'id':_0x41858a[0x0]['id'],'email':_0x41858a[0x0][_0x4925bf(0x114)]},config[_0x4925bf(0xeb)],{'expiresIn':'24h'});_0x3e414e[_0x4925bf(0x100)](0xc8)[_0x4925bf(0x10f)]({'success':!![],'message':_0x4925bf(0x128),'data':{'userId':_0x41858a[0x0]['id'],'username':_0x41858a[0x0]['username'],'first_name':_0x41858a[0x0][_0x4925bf(0xf5)],'last_name':_0x41858a[0x0][_0x4925bf(0x118)],'email':_0x41858a[0x0][_0x4925bf(0x114)],'avatar_url':_0x41858a[0x0][_0x4925bf(0x107)],'id':_0x41858a[0x0]['id'],'role':_0x41858a[0x0]['role'],'token':_0x18c0d9,'is_enabled':0x1}});}catch(_0x866ca6){console['log']('===================error==================='),console[_0x4925bf(0xf4)](_0x866ca6),_0x3e414e[_0x4925bf(0x100)](0x1f4)[_0x4925bf(0x10f)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x866ca6[_0x4925bf(0xe7)],'message':_0x866ca6[_0x4925bf(0xe2)]});}}),router['post'](a1_0x3c014b(0x106),verifyToken,async(_0x67da85,_0x24ea65,_0x285868)=>{const _0x555188=a1_0x3c014b,{current_password:_0x580066,new_password:_0x2fff87}=_0x67da85[_0x555188(0xe9)];console['log']({'body':_0x67da85['body']});const _0x57dcb4=_0x67da85[_0x555188(0x103)][_0x555188(0x114)];let _0x3fb184;try{const [_0x561a02]=await conn['promise']()[_0x555188(0x109)](_0x555188(0xde),[_0x57dcb4]);if(_0x561a02['length']>0x0){_0x3fb184=_0x561a02[0x0];if(!await bcrypt[_0x555188(0x120)](_0x580066,_0x3fb184[_0x555188(0x110)])){_0x24ea65[_0x555188(0x100)](0x191)[_0x555188(0x10f)]({'error':_0x555188(0xea)});return;}const _0x225ba4=await bcrypt[_0x555188(0x10b)](_0x2fff87,0xa);await conn['promise']()[_0x555188(0x109)](_0x555188(0x102),[_0x225ba4,_0x57dcb4]),_0x24ea65[_0x555188(0x100)](0xc8)['json']({'success':!![]});}}catch(_0x41e7e5){console[_0x555188(0xf4)]({'err':_0x41e7e5}),_0x24ea65['status'](0x1f4)[_0x555188(0x10f)]({'error':_0x555188(0x108)});return;}}),router[a1_0x3c014b(0x11f)](a1_0x3c014b(0xe0),upload['single'](a1_0x3c014b(0x119)),verifyToken,async(_0x543d97,_0x3179a2,_0x2f56b2)=>{const _0xab2725=a1_0x3c014b,{username:_0x10ff52,first_name:_0x1cdb19,last_name:_0x3f27b9}=_0x543d97[_0xab2725(0xe9)],_0x45eddb=_0x543d97['user']['email'];let _0x1b03e8;try{const [_0x428645]=await conn[_0xab2725(0x129)]()[_0xab2725(0x109)](_0xab2725(0xde),[_0x45eddb]);_0x428645[_0xab2725(0x10e)]>0x0&&(_0x1b03e8=_0x428645[0x0]);}catch(_0x4f7d83){console[_0xab2725(0xf4)]({'err':_0x4f7d83}),_0x3179a2[_0xab2725(0x100)](0x1f4)[_0xab2725(0x10f)]({'error':_0xab2725(0x108)});return;}if(!_0x1b03e8){_0x3179a2[_0xab2725(0x100)](0x191)[_0xab2725(0x10f)]({'error':_0xab2725(0x10c)});return;}console[_0xab2725(0xf4)]({'req':_0x543d97[_0xab2725(0xe9)]});let _0x31597c=_0x1b03e8[_0xab2725(0x107)];if(_0x543d97[_0xab2725(0xee)]){const _0x2573d4='avatars/'+randomUUID()+_0xab2725(0x117);fs['copyFileSync'](_0x543d97[_0xab2725(0xee)][_0xab2725(0xf8)],'./'+_0x2573d4),fs[_0xab2725(0xfe)](_0x543d97[_0xab2725(0xee)][_0xab2725(0xf8)]),config['callbackMethod_gatewayUrl_flag']?_0x31597c=config['callbackMethod_gatewayUrl']+'/'+_0x2573d4:_0x31597c=config['ServerUrl']+'/'+_0x2573d4;}try{await conn[_0xab2725(0x129)]()[_0xab2725(0x109)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x10ff52,_0x1cdb19,_0x3f27b9,_0x31597c,_0x45eddb]);let _0x9ae2ab;try{_0x9ae2ab=jwt[_0xab2725(0x12d)]({'userId':_0x1b03e8['id'],'email':_0x1b03e8['email']},config[_0xab2725(0xeb)],{'expiresIn':'24h'});}catch(_0x34b7b2){console[_0xab2725(0xf4)](_0x34b7b2),_0x3179a2[_0xab2725(0x100)](0x1f4)[_0xab2725(0x10f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x3179a2[_0xab2725(0x100)](0xc8)['json']({'success':!![],'data':{'userId':_0x1b03e8['id'],'username':_0x10ff52,'first_name':_0x1cdb19,'last_name':_0x3f27b9,'email':_0x1b03e8[_0xab2725(0x114)],'avatar_url':_0x31597c,'token':_0x9ae2ab}});}catch(_0x34f4bd){console[_0xab2725(0xf4)]({'err':_0x34f4bd}),_0x3179a2['status'](0x1f4)['json']({'error':_0xab2725(0x108)});return;}}),module[a1_0x3c014b(0x122)]=router;
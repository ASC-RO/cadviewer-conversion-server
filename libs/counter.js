function a2_0xed5c(_0x46408a,_0x5882c0){const _0x19ea4b=a2_0x19ea();return a2_0xed5c=function(_0xed5c1e,_0x4a896f){_0xed5c1e=_0xed5c1e-0xa9;let _0x30ad02=_0x19ea4b[_0xed5c1e];return _0x30ad02;},a2_0xed5c(_0x46408a,_0x5882c0);}const a2_0x3e4165=a2_0xed5c;(function(_0x59b815,_0x302f7b){const _0x3ef9e1=a2_0xed5c,_0x416722=_0x59b815();while(!![]){try{const _0x689888=-parseInt(_0x3ef9e1(0xc3))/0x1+parseInt(_0x3ef9e1(0xd8))/0x2+-parseInt(_0x3ef9e1(0xec))/0x3+parseInt(_0x3ef9e1(0xaa))/0x4+-parseInt(_0x3ef9e1(0xda))/0x5+-parseInt(_0x3ef9e1(0xb1))/0x6*(-parseInt(_0x3ef9e1(0xb6))/0x7)+parseInt(_0x3ef9e1(0xd2))/0x8;if(_0x689888===_0x302f7b)break;else _0x416722['push'](_0x416722['shift']());}catch(_0xfd55a8){_0x416722['push'](_0x416722['shift']());}}}(a2_0x19ea,0xa83d4));const fs=require('fs')['promises'],osu=require('node-os-utils');class RequestMonitor{static [a2_0x3e4165(0xdc)]=a2_0x3e4165(0xe4);static ['httpCodesStoragePath']=a2_0x3e4165(0xed);static [a2_0x3e4165(0xae)]=a2_0x3e4165(0xdf);static [a2_0x3e4165(0xb2)]=[];static [a2_0x3e4165(0xdb)]=[];static [a2_0x3e4165(0xd5)]={};static [a2_0x3e4165(0xbc)]=Math[a2_0x3e4165(0xb0)](Date['now']()/0x3e8/0x3c);static [a2_0x3e4165(0xd9)]=0x0;static async[a2_0x3e4165(0xc6)](){const _0x555a2e=a2_0x3e4165;console[_0x555a2e(0xbb)]('Initializing\x20request\x20monitor...');try{const _0x4a278a=await fs[_0x555a2e(0xad)](RequestMonitor[_0x555a2e(0xdc)],_0x555a2e(0xde));RequestMonitor[_0x555a2e(0xb2)]=JSON['parse'](_0x4a278a);}catch(_0xd1f62b){RequestMonitor[_0x555a2e(0xb2)]=[];}try{const _0x5f5c46=await fs[_0x555a2e(0xad)](RequestMonitor[_0x555a2e(0xaf)],'utf8');RequestMonitor['httpCodesData']=JSON['parse'](_0x5f5c46);}catch(_0x1eb80d){RequestMonitor[_0x555a2e(0xdb)]=[];}try{const _0x1ac649=await fs[_0x555a2e(0xad)](RequestMonitor[_0x555a2e(0xae)],_0x555a2e(0xde));RequestMonitor[_0x555a2e(0xd5)]=JSON[_0x555a2e(0xcb)](_0x1ac649),!RequestMonitor[_0x555a2e(0xd5)]['cpu']&&(RequestMonitor[_0x555a2e(0xd5)][_0x555a2e(0xeb)]=[]),!RequestMonitor[_0x555a2e(0xd5)][_0x555a2e(0xe6)]&&(RequestMonitor['ressourcesUsageStats'][_0x555a2e(0xe6)]=[]),!RequestMonitor[_0x555a2e(0xd5)][_0x555a2e(0xe9)]&&(RequestMonitor[_0x555a2e(0xd5)]['network']=[]);}catch(_0x4fcb49){RequestMonitor[_0x555a2e(0xd5)]={'cpu':[],'memory':[],'network':[]};}console[_0x555a2e(0xbb)](_0x555a2e(0xb9));}static[a2_0x3e4165(0xd6)](_0x53a40d,_0x2abb1a,_0x26e4d6){const _0x5e7362=a2_0x3e4165;if(_0x53a40d[_0x5e7362(0xe0)][_0x5e7362(0xb8)]('/metrics'))return _0x26e4d6();console[_0x5e7362(0xbb)](_0x5e7362(0xc1));let _0x2575bd=Date[_0x5e7362(0xb4)](),_0x1f739e=Math[_0x5e7362(0xb0)](_0x2575bd/0x3e8/0x3c);console[_0x5e7362(0xbb)](_0x5e7362(0xe1));const _0x3036b8=_0x2abb1a['end'];_0x2abb1a['end']=(..._0x14347c)=>{const _0xb8903d=_0x5e7362;console[_0xb8903d(0xbb)](_0x1f739e,{'currentMinute':_0x1f739e});_0x1f739e>RequestMonitor[_0xb8903d(0xbc)]&&(RequestMonitor[_0xb8903d(0xb2)][_0xb8903d(0xc7)]({'timestamp':RequestMonitor[_0xb8903d(0xbc)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0xb8903d(0xd9)]=0x0,RequestMonitor[_0xb8903d(0xbc)]=_0x1f739e);RequestMonitor['currentRequests']++,RequestMonitor[_0xb8903d(0xdb)]['push']({'timestamp':Date[_0xb8903d(0xb4)](),'statusCode':_0x2abb1a['statusCode'],'path':_0x53a40d['path'],'method':_0x53a40d[_0xb8903d(0xba)]});const _0x3f3cfb=Date[_0xb8903d(0xb4)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0xb8903d(0xdb)][_0xb8903d(0xc8)](_0x46d85a=>_0x46d85a[_0xb8903d(0xe7)]>_0x3f3cfb),_0x3036b8[_0xb8903d(0xc0)](_0x2abb1a,_0x14347c);},_0x26e4d6();}static async[a2_0x3e4165(0xea)](){const _0x5be0af=a2_0x3e4165;try{RequestMonitor[_0x5be0af(0xbc)]!==Math[_0x5be0af(0xb0)](Date[_0x5be0af(0xb4)]()/0x3e8/0x3c)&&(RequestMonitor[_0x5be0af(0xb2)]['push']({'timestamp':RequestMonitor[_0x5be0af(0xbc)]*0x3e8*0x3c,'requests':RequestMonitor[_0x5be0af(0xd9)]}),RequestMonitor[_0x5be0af(0xd9)]=0x0,RequestMonitor['lastMinute']=Math['floor'](Date[_0x5be0af(0xb4)]()/0x3e8/0x3c)),await fs[_0x5be0af(0xbf)](RequestMonitor['rpsStoragePath'],JSON['stringify'](RequestMonitor[_0x5be0af(0xb2)],null,0x2)),await fs[_0x5be0af(0xbf)](RequestMonitor[_0x5be0af(0xaf)],JSON[_0x5be0af(0xe3)](RequestMonitor[_0x5be0af(0xdb)],null,0x2));}catch(_0x17c32c){console[_0x5be0af(0xd7)](_0x5be0af(0xc2),_0x17c32c);}}static async[a2_0x3e4165(0xc4)](){const _0x5797ad=a2_0x3e4165;setInterval(()=>RequestMonitor[_0x5797ad(0xea)](),0x3c*0x3e8),setInterval(()=>{const _0x246e52=_0x5797ad;RequestMonitor[_0x246e52(0xcc)]()[_0x246e52(0xd1)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x5797ad(0xcc)]()[_0x5797ad(0xd1)](()=>{});}static async[a2_0x3e4165(0xcc)](){const _0x497bad=a2_0x3e4165,_0x187a3e=osu[_0x497bad(0xeb)],_0x23e6c8=osu['mem'],_0x30a63b=osu[_0x497bad(0xca)],_0xd85f3f={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x22f521=await _0x30a63b['inOut']();_0xd85f3f[_0x497bad(0xa9)]['inputMb']=_0x22f521[_0x497bad(0xa9)]['inputMb'],_0xd85f3f['total']['outputMb']=_0x22f521[_0x497bad(0xa9)]['outputMb'];}catch(_0x284621){}let _0x5bcc88=0x0;try{_0x5bcc88=await _0x187a3e[_0x497bad(0xc5)]();}catch(_0x1695ff){console[_0x497bad(0xbb)]('Error\x20getting\x20CPU\x20usage:',_0x1695ff);}const _0x321e12={'usedMemMb':0x0};try{const _0x4ca05e=await _0x23e6c8[_0x497bad(0xab)]();_0x321e12[_0x497bad(0xbe)]=_0x4ca05e[_0x497bad(0xbe)];}catch(_0x41f409){console['log'](_0x497bad(0xbd),_0x41f409);}const _0x4638d7=new Date()[_0x497bad(0xcd)]()[_0x497bad(0xcf)]()[_0x497bad(0xc9)](0x2,'0')+':'+new Date()[_0x497bad(0xb3)]()[_0x497bad(0xcf)]()[_0x497bad(0xc9)](0x2,'0');RequestMonitor[_0x497bad(0xd5)][_0x497bad(0xeb)]=RequestMonitor[_0x497bad(0xd5)][_0x497bad(0xeb)][_0x497bad(0xdd)](-0x3c)[_0x497bad(0xc8)](_0x3e0f23=>_0x3e0f23['time']!==_0x4638d7),RequestMonitor[_0x497bad(0xd5)]['memory']=RequestMonitor[_0x497bad(0xd5)][_0x497bad(0xe6)][_0x497bad(0xdd)](-0x3c)[_0x497bad(0xc8)](_0x59a8bf=>_0x59a8bf[_0x497bad(0xac)]!==_0x4638d7),RequestMonitor[_0x497bad(0xd5)]['network']=RequestMonitor['ressourcesUsageStats']['network'][_0x497bad(0xdd)](-0x3c)['filter'](_0x1b3391=>_0x1b3391[_0x497bad(0xac)]!==_0x4638d7),RequestMonitor[_0x497bad(0xd5)][_0x497bad(0xeb)][_0x497bad(0xc7)]({'time':_0x4638d7,'usage':_0x5bcc88}),RequestMonitor['ressourcesUsageStats'][_0x497bad(0xe6)][_0x497bad(0xc7)]({'time':_0x4638d7,'usage':(_0x321e12[_0x497bad(0xbe)]/0x3e8)[_0x497bad(0xd0)](0x2)}),RequestMonitor[_0x497bad(0xd5)]['network'][_0x497bad(0xc7)]({'time':_0x4638d7,'usage':{'in':_0xd85f3f['total']?.['inputMb']??0x0,'out':_0xd85f3f['total']?.[_0x497bad(0xe5)]??0x0}});try{await fs[_0x497bad(0xbf)](RequestMonitor[_0x497bad(0xae)],JSON[_0x497bad(0xe3)](RequestMonitor[_0x497bad(0xd5)],null,0x2));}catch(_0x54fd5f){console[_0x497bad(0xd7)]('Error\x20saving\x20monitoring\x20data:',_0x54fd5f);}}static[a2_0x3e4165(0xe2)](){const _0xbf9166=a2_0x3e4165,_0x38d6b5=Date[_0xbf9166(0xb4)](),_0x506cbf=_0x38d6b5-0x3c*0x3c*0x3e8,_0x157760=_0x38d6b5-0x18*0x3c*0x3c*0x3e8,_0x589a61=RequestMonitor[_0xbf9166(0xb2)][_0xbf9166(0xc8)](_0x28e07f=>_0x28e07f[_0xbf9166(0xe7)]>_0x506cbf),_0x15578a={'total':RequestMonitor[_0xbf9166(0xdb)][_0xbf9166(0xd4)],'byCodes':{},'byPath':{}};return RequestMonitor[_0xbf9166(0xdb)][_0xbf9166(0xe8)](_0x188a05=>{const _0x38b075=_0xbf9166;_0x15578a[_0x38b075(0xce)][_0x188a05['statusCode']]=(_0x15578a[_0x38b075(0xce)][_0x188a05[_0x38b075(0xb7)]]||0x0)+0x1;const _0x2c7ba6=_0x188a05[_0x38b075(0xba)]+'\x20'+_0x188a05['path'];!_0x15578a[_0x38b075(0xd3)][_0x2c7ba6]&&(_0x15578a['byPath'][_0x2c7ba6]={'total':0x0,'codes':{}}),_0x15578a[_0x38b075(0xd3)][_0x2c7ba6][_0x38b075(0xa9)]++,_0x15578a[_0x38b075(0xd3)][_0x2c7ba6][_0x38b075(0xb5)][_0x188a05[_0x38b075(0xb7)]]=(_0x15578a['byPath'][_0x2c7ba6][_0x38b075(0xb5)][_0x188a05[_0x38b075(0xb7)]]||0x0)+0x1;}),{'rps':_0x589a61,'httpCodes':_0x15578a,'ressourcesUsageStats':RequestMonitor[_0xbf9166(0xd5)]};}}RequestMonitor['init']()[a2_0x3e4165(0xd1)](()=>{}),RequestMonitor[a2_0x3e4165(0xc4)]();function a2_0x19ea(){const _0x1f5aa0=['usedMemMb','writeFile','apply','Request\x20monitor\x20middleware','Error\x20saving\x20monitoring\x20data:','307185VKbxgh','startPeriodicSave','usage','init','push','filter','padStart','netstat','parse','getUsageRessourcesStatsAndSave','getHours','byCodes','toString','toFixed','then','3315216lwyjlL','byPath','length','ressourcesUsageStats','middleware','error','1596342bEwtCG','currentRequests','4251355yCsTpU','httpCodesData','rpsStoragePath','slice','utf8','cadviewer/settings/ressources-usage-stats.json','path','=======>','getStats','stringify','cadviewer/settings/requests-per-minute.json','outputMb','memory','timestamp','forEach','network','save','cpu','471135lFsaHu','cadviewer/settings/http-codes-24h.json','total','49868rRLrEP','info','time','readFile','ressourcesUsageStatsPath','httpCodesStoragePath','floor','198NxuLMK','rpsData','getMinutes','now','codes','165151jEtceD','statusCode','includes','Request\x20monitor\x20initialized.','method','log','lastMinute','Error\x20getting\x20memory\x20usage:'];a2_0x19ea=function(){return _0x1f5aa0;};return a2_0x19ea();}const counter=RequestMonitor;module['exports']=counter;
const a2_0x38df23=a2_0x3ab1;function a2_0x3ab1(_0x3c73ca,_0x435228){const _0x4185a7=a2_0x4185();return a2_0x3ab1=function(_0x3ab141,_0x47d7aa){_0x3ab141=_0x3ab141-0x1a2;let _0x4aed4c=_0x4185a7[_0x3ab141];return _0x4aed4c;},a2_0x3ab1(_0x3c73ca,_0x435228);}(function(_0x45b500,_0x11ae8){const _0x1cf483=a2_0x3ab1,_0x5d7132=_0x45b500();while(!![]){try{const _0x44dd76=-parseInt(_0x1cf483(0x1ae))/0x1+parseInt(_0x1cf483(0x1cd))/0x2*(-parseInt(_0x1cf483(0x1b1))/0x3)+parseInt(_0x1cf483(0x1d4))/0x4+-parseInt(_0x1cf483(0x1bc))/0x5*(parseInt(_0x1cf483(0x1c0))/0x6)+-parseInt(_0x1cf483(0x1e4))/0x7*(parseInt(_0x1cf483(0x1b6))/0x8)+parseInt(_0x1cf483(0x1b9))/0x9+parseInt(_0x1cf483(0x1d6))/0xa*(parseInt(_0x1cf483(0x1eb))/0xb);if(_0x44dd76===_0x11ae8)break;else _0x5d7132['push'](_0x5d7132['shift']());}catch(_0x279aea){_0x5d7132['push'](_0x5d7132['shift']());}}}(a2_0x4185,0x53108));const fs=require('fs')[a2_0x38df23(0x1de)],osu=require('node-os-utils');class RequestMonitor{static [a2_0x38df23(0x1e8)]='cadviewer/settings/requests-per-minute.json';static [a2_0x38df23(0x1e1)]=a2_0x38df23(0x1bf);static ['ressourcesUsageStatsPath']=a2_0x38df23(0x1d3);static [a2_0x38df23(0x1ad)]=[];static ['httpCodesData']=[];static [a2_0x38df23(0x1e3)]={};static ['lastMinute']=Math[a2_0x38df23(0x1df)](Date[a2_0x38df23(0x1ea)]()/0x3e8/0x3c);static [a2_0x38df23(0x1be)]=0x0;static async[a2_0x38df23(0x1cf)](){const _0x1c4e1d=a2_0x38df23;console['log'](_0x1c4e1d(0x1da));try{const _0x543fe4=await fs[_0x1c4e1d(0x1b0)](RequestMonitor[_0x1c4e1d(0x1e8)],_0x1c4e1d(0x1d2));RequestMonitor[_0x1c4e1d(0x1ad)]=JSON[_0x1c4e1d(0x1ba)](_0x543fe4);}catch(_0x5b36fa){RequestMonitor[_0x1c4e1d(0x1ad)]=[];}try{const _0xa4e6c4=await fs[_0x1c4e1d(0x1b0)](RequestMonitor[_0x1c4e1d(0x1e1)],_0x1c4e1d(0x1d2));RequestMonitor[_0x1c4e1d(0x1e9)]=JSON[_0x1c4e1d(0x1ba)](_0xa4e6c4);}catch(_0x1866a6){RequestMonitor['httpCodesData']=[];}try{const _0x17a13b=await fs[_0x1c4e1d(0x1b0)](RequestMonitor[_0x1c4e1d(0x1a3)],_0x1c4e1d(0x1d2));RequestMonitor['ressourcesUsageStats']=JSON[_0x1c4e1d(0x1ba)](_0x17a13b),!RequestMonitor['ressourcesUsageStats']['cpu']&&(RequestMonitor[_0x1c4e1d(0x1e3)][_0x1c4e1d(0x1e2)]=[]),!RequestMonitor[_0x1c4e1d(0x1e3)][_0x1c4e1d(0x1a7)]&&(RequestMonitor['ressourcesUsageStats'][_0x1c4e1d(0x1a7)]=[]),!RequestMonitor[_0x1c4e1d(0x1e3)][_0x1c4e1d(0x1e5)]&&(RequestMonitor[_0x1c4e1d(0x1e3)][_0x1c4e1d(0x1e5)]=[]);}catch(_0x4135fc){RequestMonitor[_0x1c4e1d(0x1e3)]={'cpu':[],'memory':[],'network':[]};}console[_0x1c4e1d(0x1cc)](_0x1c4e1d(0x1a8));}static[a2_0x38df23(0x1c3)](_0x335750,_0x46d8e7,_0x17f7a1){const _0x4969bf=a2_0x38df23;if(_0x335750[_0x4969bf(0x1b5)]['includes'](_0x4969bf(0x1db)))return _0x17f7a1();console['log'](_0x4969bf(0x1c4));let _0x5005e5=Date[_0x4969bf(0x1ea)](),_0x325b2d=Math['floor'](_0x5005e5/0x3e8/0x3c);console[_0x4969bf(0x1cc)](_0x4969bf(0x1b7));const _0x56dfb1=_0x46d8e7[_0x4969bf(0x1ec)];_0x46d8e7['end']=(..._0x57caad)=>{const _0x440388=_0x4969bf;console[_0x440388(0x1cc)](_0x325b2d,{'currentMinute':_0x325b2d});_0x325b2d>RequestMonitor[_0x440388(0x1ab)]&&(RequestMonitor['rpsData'][_0x440388(0x1b3)]({'timestamp':RequestMonitor[_0x440388(0x1ab)]*0x3e8*0x3c,'requests':RequestMonitor[_0x440388(0x1be)]}),RequestMonitor[_0x440388(0x1be)]=0x0,RequestMonitor['lastMinute']=_0x325b2d);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x440388(0x1b3)]({'timestamp':Date[_0x440388(0x1ea)](),'statusCode':_0x46d8e7[_0x440388(0x1c6)],'path':_0x335750[_0x440388(0x1b5)],'method':_0x335750[_0x440388(0x1af)]});const _0x1212e5=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x440388(0x1e9)]=RequestMonitor[_0x440388(0x1e9)][_0x440388(0x1c7)](_0x7c85b9=>_0x7c85b9[_0x440388(0x1cb)]>_0x1212e5),_0x56dfb1[_0x440388(0x1c2)](_0x46d8e7,_0x57caad);},_0x17f7a1();}static async[a2_0x38df23(0x1b2)](){const _0x446d46=a2_0x38df23;try{RequestMonitor[_0x446d46(0x1ab)]!==Math[_0x446d46(0x1df)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x446d46(0x1ad)][_0x446d46(0x1b3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x446d46(0x1be)]=0x0,RequestMonitor['lastMinute']=Math[_0x446d46(0x1df)](Date[_0x446d46(0x1ea)]()/0x3e8/0x3c)),await fs[_0x446d46(0x1ac)](RequestMonitor[_0x446d46(0x1e8)],JSON[_0x446d46(0x1bb)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x446d46(0x1ac)](RequestMonitor[_0x446d46(0x1e1)],JSON[_0x446d46(0x1bb)](RequestMonitor[_0x446d46(0x1e9)],null,0x2));}catch(_0x2172b3){console['error'](_0x446d46(0x1c8),_0x2172b3);}}static async['startPeriodicSave'](){const _0xc4fa38=a2_0x38df23;setInterval(()=>RequestMonitor[_0xc4fa38(0x1b2)](),0x3c*0x3e8),setInterval(()=>{const _0x2cf183=_0xc4fa38;RequestMonitor[_0x2cf183(0x1a6)]()[_0x2cf183(0x1a2)](()=>{});},0x3c*0x3e8),RequestMonitor[_0xc4fa38(0x1a6)]()[_0xc4fa38(0x1a2)](()=>{});}static async[a2_0x38df23(0x1a6)](){const _0xc29db2=a2_0x38df23,_0x32153c=osu[_0xc29db2(0x1e2)],_0x1d2bd5=osu[_0xc29db2(0x1aa)],_0x1a40c2=osu[_0xc29db2(0x1a5)],_0x598d3e={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x4e3d4b=await _0x1a40c2['inOut']();_0x598d3e['total'][_0xc29db2(0x1d7)]=_0x4e3d4b['total']['inputMb'],_0x598d3e[_0xc29db2(0x1d8)][_0xc29db2(0x1e6)]=_0x4e3d4b[_0xc29db2(0x1d8)][_0xc29db2(0x1e6)];}catch(_0x1a5cdb){}let _0xb6f9c4=0x0;try{_0xb6f9c4=await _0x32153c[_0xc29db2(0x1d9)]();}catch(_0xad09e6){console['log'](_0xc29db2(0x1ca),_0xad09e6);}const _0x4d2d82={'usedMemMb':0x0};try{const _0x4570a9=await _0x1d2bd5['info']();_0x4d2d82[_0xc29db2(0x1a4)]=_0x4570a9['usedMemMb'];}catch(_0x3354fe){console[_0xc29db2(0x1cc)](_0xc29db2(0x1a9),_0x3354fe);}const _0x5aca7b=new Date()[_0xc29db2(0x1e7)]()['toString']()[_0xc29db2(0x1dd)](0x2,'0')+':'+new Date()[_0xc29db2(0x1dc)]()['toString']()[_0xc29db2(0x1dd)](0x2,'0');RequestMonitor[_0xc29db2(0x1e3)][_0xc29db2(0x1e2)]=RequestMonitor[_0xc29db2(0x1e3)][_0xc29db2(0x1e2)][_0xc29db2(0x1c1)](-0x3c)[_0xc29db2(0x1c7)](_0x52d846=>_0x52d846[_0xc29db2(0x1d1)]!==_0x5aca7b),RequestMonitor[_0xc29db2(0x1e3)][_0xc29db2(0x1a7)]=RequestMonitor[_0xc29db2(0x1e3)][_0xc29db2(0x1a7)][_0xc29db2(0x1c1)](-0x3c)[_0xc29db2(0x1c7)](_0x4a8ce2=>_0x4a8ce2[_0xc29db2(0x1d1)]!==_0x5aca7b),RequestMonitor[_0xc29db2(0x1e3)]['network']=RequestMonitor[_0xc29db2(0x1e3)]['network'][_0xc29db2(0x1c1)](-0x3c)[_0xc29db2(0x1c7)](_0x528d19=>_0x528d19[_0xc29db2(0x1d1)]!==_0x5aca7b),RequestMonitor[_0xc29db2(0x1e3)][_0xc29db2(0x1e2)]['push']({'time':_0x5aca7b,'usage':_0xb6f9c4}),RequestMonitor['ressourcesUsageStats']['memory'][_0xc29db2(0x1b3)]({'time':_0x5aca7b,'usage':(_0x4d2d82[_0xc29db2(0x1a4)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0xc29db2(0x1e3)]['network'][_0xc29db2(0x1b3)]({'time':_0x5aca7b,'usage':{'in':_0x598d3e[_0xc29db2(0x1d8)]?.[_0xc29db2(0x1d7)]??0x0,'out':_0x598d3e['total']?.['outputMb']??0x0}});try{await fs['writeFile'](RequestMonitor[_0xc29db2(0x1a3)],JSON[_0xc29db2(0x1bb)](RequestMonitor[_0xc29db2(0x1e3)],null,0x2));}catch(_0x2fa2d7){console[_0xc29db2(0x1b8)](_0xc29db2(0x1c8),_0x2fa2d7);}}static[a2_0x38df23(0x1ce)](){const _0x1a5e08=a2_0x38df23,_0x3b3f3e=Date[_0x1a5e08(0x1ea)](),_0xe82aa4=_0x3b3f3e-0x3c*0x3c*0x3e8,_0x2ee470=_0x3b3f3e-0x18*0x3c*0x3c*0x3e8,_0x3651d6=RequestMonitor[_0x1a5e08(0x1ad)][_0x1a5e08(0x1c7)](_0x646d72=>_0x646d72[_0x1a5e08(0x1cb)]>_0xe82aa4),_0x53f943={'total':RequestMonitor[_0x1a5e08(0x1e9)][_0x1a5e08(0x1b4)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x1a5e08(0x1e9)][_0x1a5e08(0x1c9)](_0x47ae43=>{const _0x36c0c2=_0x1a5e08;_0x53f943[_0x36c0c2(0x1d5)][_0x47ae43[_0x36c0c2(0x1c6)]]=(_0x53f943[_0x36c0c2(0x1d5)][_0x47ae43[_0x36c0c2(0x1c6)]]||0x0)+0x1;const _0x361848=_0x47ae43[_0x36c0c2(0x1af)]+'\x20'+_0x47ae43[_0x36c0c2(0x1b5)];!_0x53f943[_0x36c0c2(0x1d0)][_0x361848]&&(_0x53f943[_0x36c0c2(0x1d0)][_0x361848]={'total':0x0,'codes':{}}),_0x53f943[_0x36c0c2(0x1d0)][_0x361848]['total']++,_0x53f943[_0x36c0c2(0x1d0)][_0x361848]['codes'][_0x47ae43[_0x36c0c2(0x1c6)]]=(_0x53f943[_0x36c0c2(0x1d0)][_0x361848][_0x36c0c2(0x1bd)][_0x47ae43[_0x36c0c2(0x1c6)]]||0x0)+0x1;}),{'rps':_0x3651d6,'httpCodes':_0x53f943,'ressourcesUsageStats':RequestMonitor[_0x1a5e08(0x1e3)]};}}RequestMonitor['init']()['then'](()=>{}),RequestMonitor[a2_0x38df23(0x1e0)]();const counter=RequestMonitor;function a2_0x4185(){const _0x23ebf0=['promises','floor','startPeriodicSave','httpCodesStoragePath','cpu','ressourcesUsageStats','259xroGle','network','outputMb','getHours','rpsStoragePath','httpCodesData','now','1890119tDAKRX','end','then','ressourcesUsageStatsPath','usedMemMb','netstat','getUsageRessourcesStatsAndSave','memory','Request\x20monitor\x20initialized.','Error\x20getting\x20memory\x20usage:','mem','lastMinute','writeFile','rpsData','3269EHbEZc','method','readFile','151632mOsViR','save','push','length','path','99832yrjjfg','=======>','error','4133952DNQbok','parse','stringify','175yZkbzt','codes','currentRequests','cadviewer/settings/http-codes-24h.json','90534YiTzhI','slice','apply','middleware','Request\x20monitor\x20middleware','exports','statusCode','filter','Error\x20saving\x20monitoring\x20data:','forEach','Error\x20getting\x20CPU\x20usage:','timestamp','log','6nQEdvE','getStats','init','byPath','time','utf8','cadviewer/settings/ressources-usage-stats.json','665992ELbPQO','byCodes','50KDuDbF','inputMb','total','usage','Initializing\x20request\x20monitor...','/metrics','getMinutes','padStart'];a2_0x4185=function(){return _0x23ebf0;};return a2_0x4185();}module[a2_0x38df23(0x1c5)]=counter;
const a3_0x3cd831=a3_0x1e80;function a3_0x48b5(){const _0x1a00ed=['12\x20hours','frontendUrl','49935EVBfOC','sendMail','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20</html>\x0a\x20\x20','length','1591336DLVOnE','Error\x20while\x20fetching\x20users\x20for\x20account\x20deletion\x20prevention\x20emails','No\x20users\x20to\x20notify\x20about\x20account\x20deletion','Follow-up\x20email\x20sent\x20to\x20','username','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','300698Seqdhr','9535350cljscZ','Please\x20validate\x20your\x20CADViewer\x20email\x20address','./mysql.js','Failed\x20to\x20send\x20welcome\x20email\x20to\x20','6iSMHRU',',</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20noticed\x20that\x20you\x20haven\x27t\x20validated\x20your\x20email\x20address\x20yet.\x20It\x27s\x20been\x20','execute','6\x20hours','transporter','5047399XtnLWS','6637340wFgZQH','error','promise','log','3\x20hours','demoUserRetentionDays','Failed\x20to\x20send\x20follow-up\x20email\x20to\x20','Error\x20in\x20sendFollowUpEmails:','email','endsWith','/validate-email/','UPDATE\x20users\x20SET\x20follow_up_count\x20=\x20follow_up_count\x20+\x201\x20WHERE\x20id\x20=\x20?','CADViewer\x20Email\x20Validation\x20Reminder',',</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20wanted\x20to\x20inform\x20you\x20that\x20your\x20demo\x20account\x20will\x20expire\x20in\x202\x20days\x20and\x20will\x20be\x20automatically\x20deleted.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20you\x20wish\x20to\x20keep\x20your\x20account\x20and\x20all\x20your\x20data,\x20please\x20contact\x20us\x20on\x20<a\x20href=\x22mailto:developer@tailormade.com\x22>developer@tailormade.com</a>\x20or\x20<a\x20href=\x22mailto:internationalsales@tailormade.com\x22>internationalsales@tailormade.com</a>\x20as\x20soon\x20as\x20possible.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Thank\x20you\x20for\x20using\x20CADViewer!</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20</html>\x0a\x20\x20','\x0a\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>CADViewer\x20Email\x20Validation\x20Reminder</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Hello\x20','follow_up_count','smtpFrom','Important:\x20Your\x20CADViewer\x20Account\x20Will\x20Expire\x20Soon','Welcome\x20to\x20CADViewer','22IzEHzI','Your\x20CADViewer\x20demo\x20account\x20will\x20expire\x20in\x202\x20days.\x20Please\x20contact\x20an\x20administrator\x20if\x20you\x20wish\x20to\x20keep\x20your\x20account.','SELECT\x20*\x20FROM\x20users\x20WHERE\x20role\x20=\x20\x27demo_user\x27\x20AND\x20created_at\x20<\x20DATE_SUB(NOW(),\x20INTERVAL\x20?\x20DAY)','first_name','1237768LiQqIu','140cPPvBk','===================error===================','18QjAwOn','\x20since\x20you\x20registered.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'];a3_0x48b5=function(){return _0x1a00ed;};return a3_0x48b5();}function a3_0x1e80(_0x456242,_0x584b12){const _0x48b57b=a3_0x48b5();return a3_0x1e80=function(_0x1e8023,_0x1bf6d7){_0x1e8023=_0x1e8023-0x1bc;let _0xd9b72a=_0x48b57b[_0x1e8023];return _0xd9b72a;},a3_0x1e80(_0x456242,_0x584b12);}(function(_0x436cd1,_0x56964f){const _0x359f05=a3_0x1e80,_0x5dbee2=_0x436cd1();while(!![]){try{const _0x12c1ff=parseInt(_0x359f05(0x1cc))/0x1+parseInt(_0x359f05(0x1c6))/0x2+parseInt(_0x359f05(0x1c2))/0x3*(-parseInt(_0x359f05(0x1bc))/0x4)+-parseInt(_0x359f05(0x1cd))/0x5+-parseInt(_0x359f05(0x1d1))/0x6*(-parseInt(_0x359f05(0x1d6))/0x7)+parseInt(_0x359f05(0x1ee))/0x8*(parseInt(_0x359f05(0x1be))/0x9)+-parseInt(_0x359f05(0x1d7))/0xa*(-parseInt(_0x359f05(0x1ea))/0xb);if(_0x12c1ff===_0x56964f)break;else _0x5dbee2['push'](_0x5dbee2['shift']());}catch(_0x282fa6){_0x5dbee2['push'](_0x5dbee2['shift']());}}}(a3_0x48b5,0xeb850));const config=require('../CADViewer_config.json'),conn=require(a3_0x3cd831(0x1cf)),transporter=require('./mail.js')[a3_0x3cd831(0x1d5)],getWelcomeEmailTemplate=(_0x37bdde,_0xbf54b2)=>{const _0x439e28=a3_0x3cd831;return'\x0a\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0xbf54b2+_0x439e28(0x1cb)+_0xbf54b2+_0x439e28(0x1c4);},sendWelcomeEmail=async(_0x5aa91a,_0x59c13c)=>{const _0x53a08d=a3_0x3cd831;try{let _0x3e90f6=config[_0x53a08d(0x1c1)];_0x3e90f6[_0x53a08d(0x1e0)]('/')&&(_0x3e90f6=_0x3e90f6['slice'](0x0,-0x1));const _0x3512d4=_0x3e90f6+_0x53a08d(0x1e1)+_0x59c13c,_0x41777a=getWelcomeEmailTemplate(_0x5aa91a,_0x3512d4),_0x503954={'from':config[_0x53a08d(0x1e7)],'to':_0x5aa91a[_0x53a08d(0x1df)],'subject':_0x53a08d(0x1e9),'text':_0x53a08d(0x1e9),'html':_0x41777a};await transporter[_0x53a08d(0x1c3)](_0x503954),console[_0x53a08d(0x1da)]('Welcome\x20email\x20sent\x20to\x20'+_0x5aa91a[_0x53a08d(0x1df)]);}catch(_0x458685){console[_0x53a08d(0x1da)](_0x53a08d(0x1bd)),console['log'](_0x53a08d(0x1d0)+_0x5aa91a[_0x53a08d(0x1df)]+':',_0x458685);throw _0x458685;}},getAccountDeletionPreventionTemplate=_0xbd2029=>{const _0x256469=a3_0x3cd831;return'\x0a\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Important:\x20Your\x20CADViewer\x20Account</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Hello\x20'+(_0xbd2029[_0x256469(0x1ed)]||_0xbd2029[_0x256469(0x1ca)])+_0x256469(0x1e4);},sendAccountDeletionPreventionEmails=async()=>{const _0x193432=a3_0x3cd831;try{const [_0x15544c]=await conn[_0x193432(0x1d9)]()['execute'](_0x193432(0x1ec),[config[_0x193432(0x1dc)]-config['demoUserRetentionDaysAlertBeforeDeletion']]);if(_0x15544c[_0x193432(0x1c5)]===0x0){console[_0x193432(0x1da)](_0x193432(0x1c8));return;}for(const _0x294883 of _0x15544c){const _0x30c2e4=getAccountDeletionPreventionTemplate(_0x294883),_0x27082a={'from':config[_0x193432(0x1e7)],'to':_0x294883[_0x193432(0x1df)],'subject':_0x193432(0x1e8),'text':_0x193432(0x1eb),'html':_0x30c2e4};try{await transporter[_0x193432(0x1c3)](_0x27082a),console['log']('Deletion\x20prevention\x20email\x20sent\x20to\x20'+_0x294883[_0x193432(0x1df)]);}catch(_0xf75709){console[_0x193432(0x1da)]('===================error==================='),console[_0x193432(0x1da)]('Failed\x20to\x20send\x20email\x20to\x20'+_0x294883[_0x193432(0x1df)]),console[_0x193432(0x1da)](_0xf75709);}}}catch(_0x465101){console[_0x193432(0x1da)]('===================error==================='),console[_0x193432(0x1da)](_0x193432(0x1c7)),console[_0x193432(0x1da)](_0x465101);}},getFollowUpEmailTemplate=(_0x432e28,_0x554473,_0x2a6c1b)=>{const _0x5ba2d7=a3_0x3cd831,_0x585ea6={0x1:_0x5ba2d7(0x1db),0x2:_0x5ba2d7(0x1d4),0x3:_0x5ba2d7(0x1c0)}[_0x2a6c1b];return _0x5ba2d7(0x1e5)+(_0x432e28[_0x5ba2d7(0x1ed)]||_0x432e28['username'])+_0x5ba2d7(0x1d2)+_0x585ea6+_0x5ba2d7(0x1bf)+_0x554473+_0x5ba2d7(0x1cb)+_0x554473+_0x5ba2d7(0x1c4);},sendFollowUpEmails=async()=>{const _0x3812c1=a3_0x3cd831;try{const _0x2a178d='\x0a\x20\x20\x20\x20\x20\x20SELECT\x20*\x0a\x20\x20\x20\x20\x20\x20FROM\x20users\x0a\x20\x20\x20\x20\x20\x20WHERE\x20is_enabled\x20=\x200\x0a\x20\x20\x20\x20\x20\x20AND\x20validation_token\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20AND\x20follow_up_count\x20<\x203\x0a\x20\x20\x20\x20\x20\x20AND\x20created_at\x20<=\x20DATE_SUB(NOW(),\x20INTERVAL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20CASE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHEN\x20follow_up_count\x20=\x200\x20THEN\x203\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHEN\x20follow_up_count\x20=\x201\x20THEN\x206\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHEN\x20follow_up_count\x20=\x202\x20THEN\x2012\x0a\x20\x20\x20\x20\x20\x20\x20\x20END\x0a\x20\x20\x20\x20\x20\x20HOUR)\x0a\x20\x20\x20\x20',[_0x2dd385]=await conn[_0x3812c1(0x1d9)]()[_0x3812c1(0x1d3)](_0x2a178d);for(const _0x205e45 of _0x2dd385){const _0x416e9b=config[_0x3812c1(0x1c1)]+_0x3812c1(0x1e1)+_0x205e45['validation_token'],_0x319116=getFollowUpEmailTemplate(_0x205e45,_0x416e9b,_0x205e45[_0x3812c1(0x1e6)]+0x1),_0x5e100={'from':config[_0x3812c1(0x1e7)],'to':_0x205e45[_0x3812c1(0x1df)],'subject':_0x3812c1(0x1e3),'text':_0x3812c1(0x1ce),'html':_0x319116};try{await transporter[_0x3812c1(0x1c3)](_0x5e100),await conn[_0x3812c1(0x1d9)]()[_0x3812c1(0x1d3)](_0x3812c1(0x1e2),[_0x205e45['id']]),console[_0x3812c1(0x1da)](_0x3812c1(0x1c9)+_0x205e45[_0x3812c1(0x1df)]);}catch(_0x9535a3){console[_0x3812c1(0x1d8)](_0x3812c1(0x1dd)+_0x205e45['email']+':',_0x9535a3);}}}catch(_0x1f27da){console[_0x3812c1(0x1d8)](_0x3812c1(0x1de),_0x1f27da);}};module['exports']={'transporter':transporter,'sendFollowUpEmails':sendFollowUpEmails,'sendAccountDeletionPreventionEmails':sendAccountDeletionPreventionEmails,'sendWelcomeEmail':sendWelcomeEmail};